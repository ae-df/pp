<!--
  UX FEEDBACK COMPONENTS - UNIAE
  Componentes de feedback visual avançados
  
  Inclua: <?!= include('UX_Feedback_Components'); ?>
-->

<style>
/* ========================================
   PROGRESS BAR ANIMADA
   ======================================== */
.progress-bar-container {
  width: 100%;
  height: 8px;
  background: var(--gray-200, #e5e7eb);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary, #667eea), var(--primary-light, #818cf8));
  border-radius: 4px;
  transition: width 0.5s ease;
  position: relative;
}

.progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255,255,255,0.3),
    transparent
  );
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.progress-bar.success {
  background: linear-gradient(90deg, var(--success, #10b981), var(--success-light, #34d399));
}

.progress-bar.warning {
  background: linear-gradient(90deg, var(--warning, #f59e0b), var(--warning-light, #fbbf24));
}

.progress-bar.error {
  background: linear-gradient(90deg, var(--error, #ef4444), var(--error-light, #f87171));
}

/* Progress com label */
.progress-with-label {
  display: flex;
  align-items: center;
  gap: 12px;
}

.progress-with-label .progress-bar-container {
  flex: 1;
}

.progress-label {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary, #1f2937);
  min-width: 45px;
  text-align: right;
}

/* ========================================
   COUNTDOWN TIMER
   ======================================== */
.countdown {
  display: flex;
  gap: 16px;
  justify-content: center;
}

.countdown-item {
  text-align: center;
}

.countdown-value {
  font-size: 36px;
  font-weight: 700;
  color: var(--primary, #667eea);
  background: var(--bg-surface, #fff);
  padding: 12px 20px;
  border-radius: 12px;
  box-shadow: var(--shadow-md, 0 4px 6px rgba(0,0,0,0.1));
  min-width: 70px;
  font-variant-numeric: tabular-nums;
}

.countdown-label {
  font-size: 12px;
  color: var(--text-secondary, #6b7280);
  margin-top: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.countdown.urgent .countdown-value {
  color: var(--error, #ef4444);
  animation: pulse-urgent 1s infinite;
}

@keyframes pulse-urgent {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* ========================================
   STATUS INDICATOR
   ======================================== */
.status-indicator {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 500;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.status-indicator.online {
  background: var(--success-light, #d1fae5);
  color: var(--success-dark, #065f46);
}

.status-indicator.online .status-dot {
  background: var(--success, #10b981);
  animation: pulse-dot 2s infinite;
}

.status-indicator.offline {
  background: var(--gray-100, #f3f4f6);
  color: var(--gray-600, #4b5563);
}

.status-indicator.offline .status-dot {
  background: var(--gray-400, #9ca3af);
}

.status-indicator.busy {
  background: var(--warning-light, #fef3c7);
  color: var(--warning-dark, #92400e);
}

.status-indicator.busy .status-dot {
  background: var(--warning, #f59e0b);
}

.status-indicator.error {
  background: var(--error-light, #fee2e2);
  color: var(--error-dark, #991b1b);
}

.status-indicator.error .status-dot {
  background: var(--error, #ef4444);
  animation: pulse-dot 1s infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(1.2); }
}

/* ========================================
   INLINE FEEDBACK
   ======================================== */
.inline-feedback {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 13px;
  animation: fade-slide-in 0.3s ease;
}

@keyframes fade-slide-in {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.inline-feedback.success {
  background: var(--success-light, #d1fae5);
  color: var(--success-dark, #065f46);
}

.inline-feedback.error {
  background: var(--error-light, #fee2e2);
  color: var(--error-dark, #991b1b);
}

.inline-feedback.warning {
  background: var(--warning-light, #fef3c7);
  color: var(--warning-dark, #92400e);
}

.inline-feedback.info {
  background: var(--info-light, #dbeafe);
  color: var(--info-dark, #1e40af);
}

.inline-feedback .icon {
  font-size: 16px;
}

/* ========================================
   STEP INDICATOR VERTICAL
   ======================================== */
.steps-vertical {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.step-v {
  display: flex;
  gap: 16px;
  position: relative;
}

.step-v:not(:last-child)::before {
  content: '';
  position: absolute;
  left: 15px;
  top: 32px;
  bottom: -8px;
  width: 2px;
  background: var(--gray-200, #e5e7eb);
}

.step-v.completed:not(:last-child)::before {
  background: var(--success, #10b981);
}

.step-v-indicator {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--gray-200, #e5e7eb);
  color: var(--gray-500, #6b7280);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
  flex-shrink: 0;
  z-index: 1;
  transition: all 0.3s ease;
}

.step-v.completed .step-v-indicator {
  background: var(--success, #10b981);
  color: white;
}

.step-v.active .step-v-indicator {
  background: var(--primary, #667eea);
  color: white;
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
}

.step-v-content {
  flex: 1;
  padding-bottom: 24px;
}

.step-v-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text-primary, #1f2937);
  margin-bottom: 4px;
}

.step-v.completed .step-v-title {
  color: var(--success, #10b981);
}

.step-v-description {
  font-size: 13px;
  color: var(--text-secondary, #6b7280);
  line-height: 1.5;
}

/* ========================================
   RATING STARS
   ======================================== */
.rating {
  display: flex;
  gap: 4px;
}

.rating-star {
  font-size: 24px;
  cursor: pointer;
  transition: transform 0.2s, color 0.2s;
  color: var(--gray-300, #d1d5db);
}

.rating-star:hover {
  transform: scale(1.2);
}

.rating-star.active {
  color: #fbbf24;
}

.rating-star.hover {
  color: #fcd34d;
}

.rating.readonly .rating-star {
  cursor: default;
}

.rating.readonly .rating-star:hover {
  transform: none;
}

/* ========================================
   AVATAR COM STATUS
   ======================================== */
.avatar-status {
  position: relative;
  display: inline-block;
}

.avatar-status img,
.avatar-status .avatar-placeholder {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
}

.avatar-placeholder {
  background: var(--primary-light, #818cf8);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 18px;
}

.avatar-status .status-badge {
  position: absolute;
  bottom: 2px;
  right: 2px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid white;
}

.avatar-status .status-badge.online { background: var(--success, #10b981); }
.avatar-status .status-badge.offline { background: var(--gray-400, #9ca3af); }
.avatar-status .status-badge.busy { background: var(--error, #ef4444); }
.avatar-status .status-badge.away { background: var(--warning, #f59e0b); }

/* ========================================
   CHIP/TAG INTERATIVO
   ======================================== */
.chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--gray-100, #f3f4f6);
  border-radius: 16px;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-primary, #1f2937);
  transition: all 0.2s;
}

.chip.clickable {
  cursor: pointer;
}

.chip.clickable:hover {
  background: var(--gray-200, #e5e7eb);
}

.chip.selected {
  background: var(--primary, #667eea);
  color: white;
}

.chip .chip-remove {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  cursor: pointer;
  transition: background 0.2s;
}

.chip .chip-remove:hover {
  background: rgba(0,0,0,0.2);
}

.chip.selected .chip-remove {
  background: rgba(255,255,255,0.2);
}

.chip.selected .chip-remove:hover {
  background: rgba(255,255,255,0.3);
}

/* Variantes de cor */
.chip.primary { background: var(--info-light, #dbeafe); color: var(--info-dark, #1e40af); }
.chip.success { background: var(--success-light, #d1fae5); color: var(--success-dark, #065f46); }
.chip.warning { background: var(--warning-light, #fef3c7); color: var(--warning-dark, #92400e); }
.chip.error { background: var(--error-light, #fee2e2); color: var(--error-dark, #991b1b); }

/* ========================================
   TOOLTIP AVANÇADO
   ======================================== */
[data-tooltip] {
  position: relative;
}

[data-tooltip]::before,
[data-tooltip]::after {
  position: absolute;
  opacity: 0;
  visibility: hidden;
  transition: all 0.2s ease;
  pointer-events: none;
  z-index: 1000;
}

[data-tooltip]::before {
  content: attr(data-tooltip);
  background: var(--gray-900, #111827);
  color: white;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%) translateY(4px);
}

[data-tooltip]::after {
  content: '';
  border: 6px solid transparent;
  border-top-color: var(--gray-900, #111827);
  bottom: calc(100% - 4px);
  left: 50%;
  transform: translateX(-50%);
}

[data-tooltip]:hover::before,
[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

[data-tooltip]:hover::before {
  transform: translateX(-50%) translateY(0);
}

/* Tooltip posições */
[data-tooltip-pos="bottom"]::before {
  bottom: auto;
  top: calc(100% + 8px);
  transform: translateX(-50%) translateY(-4px);
}

[data-tooltip-pos="bottom"]::after {
  bottom: auto;
  top: calc(100% - 4px);
  border-top-color: transparent;
  border-bottom-color: var(--gray-900, #111827);
}

[data-tooltip-pos="bottom"]:hover::before {
  transform: translateX(-50%) translateY(0);
}

/* ========================================
   BANNER DE ALERTA
   ======================================== */
.alert-banner {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  animation: slide-down 0.3s ease;
}

@keyframes slide-down {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.alert-banner.info {
  background: linear-gradient(135deg, var(--info-light, #dbeafe), rgba(219, 234, 254, 0.5));
  border: 1px solid var(--info, #3b82f6);
}

.alert-banner.success {
  background: linear-gradient(135deg, var(--success-light, #d1fae5), rgba(209, 250, 229, 0.5));
  border: 1px solid var(--success, #10b981);
}

.alert-banner.warning {
  background: linear-gradient(135deg, var(--warning-light, #fef3c7), rgba(254, 243, 199, 0.5));
  border: 1px solid var(--warning, #f59e0b);
}

.alert-banner.error {
  background: linear-gradient(135deg, var(--error-light, #fee2e2), rgba(254, 226, 226, 0.5));
  border: 1px solid var(--error, #ef4444);
}

.alert-banner .icon {
  font-size: 24px;
  flex-shrink: 0;
}

.alert-banner .content {
  flex: 1;
}

.alert-banner .title {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 2px;
}

.alert-banner .message {
  font-size: 13px;
  opacity: 0.9;
}

.alert-banner .close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  padding: 4px;
}

.alert-banner .close:hover {
  opacity: 1;
}

.alert-banner .action-btn {
  padding: 8px 16px;
  background: rgba(0,0,0,0.1);
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
}

.alert-banner .action-btn:hover {
  background: rgba(0,0,0,0.15);
}
</style>

<script>
/**
 * Feedback Components - Funções auxiliares
 */
const FeedbackComponents = {
  // Progress bar animada
  setProgress(containerId, percentage, type = '') {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const bar = container.querySelector('.progress-bar') || container;
    bar.style.width = Math.min(100, Math.max(0, percentage)) + '%';
    
    if (type) {
      bar.className = 'progress-bar ' + type;
    }
    
    // Atualizar label se existir
    const label = container.parentElement?.querySelector('.progress-label');
    if (label) {
      label.textContent = Math.round(percentage) + '%';
    }
  },
  
  // Countdown timer
  startCountdown(containerId, targetDate, onComplete) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const update = () => {
      const now = new Date().getTime();
      const target = new Date(targetDate).getTime();
      const diff = target - now;
      
      if (diff <= 0) {
        if (onComplete) onComplete();
        return;
      }
      
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      const items = container.querySelectorAll('.countdown-value');
      if (items[0]) items[0].textContent = String(days).padStart(2, '0');
      if (items[1]) items[1].textContent = String(hours).padStart(2, '0');
      if (items[2]) items[2].textContent = String(minutes).padStart(2, '0');
      if (items[3]) items[3].textContent = String(seconds).padStart(2, '0');
      
      // Adicionar classe urgente se menos de 1 hora
      if (diff < 3600000) {
        container.classList.add('urgent');
      }
      
      requestAnimationFrame(() => setTimeout(update, 1000));
    };
    
    update();
  },
  
  // Rating stars
  initRating(containerId, initialValue = 0, onChange) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    let currentValue = initialValue;
    const stars = container.querySelectorAll('.rating-star');
    
    const updateStars = (value, isHover = false) => {
      stars.forEach((star, i) => {
        star.classList.remove('active', 'hover');
        if (i < value) {
          star.classList.add(isHover ? 'hover' : 'active');
        }
      });
    };
    
    updateStars(currentValue);
    
    if (!container.classList.contains('readonly')) {
      stars.forEach((star, i) => {
        star.addEventListener('mouseenter', () => updateStars(i + 1, true));
        star.addEventListener('mouseleave', () => updateStars(currentValue));
        star.addEventListener('click', () => {
          currentValue = i + 1;
          updateStars(currentValue);
          if (onChange) onChange(currentValue);
        });
      });
    }
    
    return {
      getValue: () => currentValue,
      setValue: (v) => { currentValue = v; updateStars(v); }
    };
  },
  
  // Inline feedback
  showInlineFeedback(containerId, message, type = 'info', duration = 5000) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const icons = { success: '✅', error: '❌', warning: '⚠️', info: 'ℹ️' };
    
    const feedback = document.createElement('div');
    feedback.className = `inline-feedback ${type}`;
    feedback.innerHTML = `
      <span class="icon">${icons[type]}</span>
      <span>${message}</span>
    `;
    
    container.innerHTML = '';
    container.appendChild(feedback);
    
    if (duration > 0) {
      setTimeout(() => {
        feedback.style.animation = 'fade-slide-in 0.3s ease reverse';
        setTimeout(() => feedback.remove(), 300);
      }, duration);
    }
  },
  
  // Alert banner
  showBanner(options) {
    const { type = 'info', title, message, action, containerId } = options;
    const icons = { success: '✅', error: '❌', warning: '⚠️', info: 'ℹ️' };
    
    const banner = document.createElement('div');
    banner.className = `alert-banner ${type}`;
    banner.innerHTML = `
      <span class="icon">${icons[type]}</span>
      <div class="content">
        ${title ? `<div class="title">${title}</div>` : ''}
        <div class="message">${message}</div>
      </div>
      ${action ? `<button class="action-btn" onclick="${action.callback}">${action.label}</button>` : ''}
      <button class="close" onclick="this.parentElement.remove()">×</button>
    `;
    
    const container = containerId ? document.getElementById(containerId) : document.body;
    container.insertBefore(banner, container.firstChild);
    
    return banner;
  },
  
  // Chips/Tags
  initChips(containerId, options = {}) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    const chips = container.querySelectorAll('.chip.clickable');
    
    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        if (options.multiSelect) {
          chip.classList.toggle('selected');
        } else {
          chips.forEach(c => c.classList.remove('selected'));
          chip.classList.add('selected');
        }
        
        if (options.onChange) {
          const selected = Array.from(container.querySelectorAll('.chip.selected'))
            .map(c => c.dataset.value || c.textContent.trim());
          options.onChange(selected);
        }
      });
    });
    
    // Remover chips
    container.querySelectorAll('.chip-remove').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const chip = btn.closest('.chip');
        if (options.onRemove) {
          options.onRemove(chip.dataset.value || chip.textContent.trim());
        }
        chip.remove();
      });
    });
  }
};

// Expor globalmente
window.FeedbackComponents = FeedbackComponents;
</script>
