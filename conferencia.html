<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Confer√™ncia</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--gradient-royal);
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    header {
      background: var(--gradient-royal);
      color: white;
      padding: 24px 32px;
    }

    header h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .content {
      padding: 32px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--gradient-royal);
      color: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: var(--font-sm);
      opacity: 0.9;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: var(--font-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      background: var(--enterprise-accent);
      color: white;
      margin-right: 10px;
    }

    .btn:hover {
      background: #5568d3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    thead {
      background: var(--bg-primary);
    }

    th,
    td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--bg-tertiary);
    }

    .badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-success {
      background: var(--success-light);
      color: var(--success-dark);
    }

    .badge-warning {
      background: var(--warning-light);
      color: var(--warning-dark);
    }

    .badge-danger {
      background: var(--error-light);
      color: var(--error-dark);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-royal);
      transition: width 0.3s;
    }
  </style>
  <link rel="stylesheet" href="design-system.css">
</head>

<body>
  <div class="container">
    <header>
      <h1>üìã Controle de Confer√™ncia - UNIAE CRE-PP</h1>
      <div style="font-size: var(--font-sm); opacity: 0.9; margin-top: var(--space-1);">
        Sistema de Gest√£o e Confer√™ncia de Notas Fiscais
      </div>
    </header>

    <div class="content">
      <div class="stats-grid" id="stats-container">
        <div class="stat-card">
          <div class="stat-value" id="stat-total">0</div>
          <div class="stat-label">Total de Controles</div>
        </div>
        <div class="stat-card"
          style="background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);">
          <div class="stat-value" id="stat-concluidos">0</div>
          <div class="stat-label">Conclu√≠dos</div>
        </div>
        <div class="stat-card"
          style="background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);">
          <div class="stat-value" id="stat-pendentes">0</div>
          <div class="stat-label">Pendentes</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, var(--error) 0%, var(--error-dark) 100%);">
          <div class="stat-value" id="stat-atrasados">0</div>
          <div class="stat-label">Atrasados</div>
        </div>
      </div>

      <div style="margin-bottom: var(--space-6);">
        <button class="btn" onclick="novoControle()">‚ûï Novo Controle</button>
        <button class="btn" onclick="atualizarEtapa()">‚úÖ Atualizar Etapa</button>
        <button class="btn" onclick="registrarOcorrencia()">‚ö†Ô∏è Registrar Ocorr√™ncia</button>
        <button class="btn" onclick="loadData()">üîÑ Atualizar</button>
      </div>

      <div id="data-container">
        <div style="text-align: center; padding: var(--space-10); color: var(--text-secondary);">
          Carregando dados...
        </div>
      </div>
    </div>
  </div>

  <script>
    window.onload = function () {
      loadData();
    };

    function loadData() {
      google.script.run
        .withSuccessHandler(displayData)
        .withFailureHandler(function (error) {
          document.getElementById('data-container').innerHTML =
            '<div style="text-align: center; padding: var(--space-10); color: var(--color-error);">‚ùå Erro: ' + error.message + '</div>';
        })
        .listControlesConferencia({});
    }

    function displayData(result) {
      if (!result.success || !result.data || result.data.length === 0) {
        document.getElementById('data-container').innerHTML =
          '<div style="text-align: center; padding: var(--space-10); color: var(--text-secondary);">Nenhum controle encontrado</div>';
        return;
      }

      const data = result.data;

      // Atualizar estat√≠sticas
      document.getElementById('stat-total').textContent = data.length;
      document.getElementById('stat-concluidos').textContent =
        data.filter(d => d.percentualConclusao === 100).length;
      document.getElementById('stat-pendentes').textContent =
        data.filter(d => d.percentualConclusao > 0 && d.percentualConclusao < 100).length;
      document.getElementById('stat-atrasados').textContent =
        data.filter(d => d.percentualConclusao === 0).length;

      // Exibir tabela
      let html = '<table><thead><tr>';
      html += '<th>ID</th><th>Unidade</th><th>NF</th><th>Fornecedor</th>';
      html += '<th>Progresso</th><th>Status</th><th>A√ß√µes</th>';
      html += '</tr></thead><tbody>';

      data.forEach(row => {
        const statusClass = row.percentualConclusao === 100 ? 'badge-success' :
          row.percentualConclusao > 0 ? 'badge-warning' : 'badge-danger';

        html += '<tr>';
        html += '<td>' + (row.ID_Controle || '-') + '</td>';
        html += '<td>' + (row.Unidade_Escolar || '-') + '</td>';
        html += '<td>' + (row.Numero_NF || '-') + '</td>';
        html += '<td>' + (row.Fornecedor || '-') + '</td>';
        html += '<td><div class="progress-bar"><div class="progress-fill" style="width: ' +
          row.percentualConclusao + '%"></div></div>' + row.percentualConclusao + '%</td>';
        html += '<td><span class="badge ' + statusClass + '">' +
          (row.percentualConclusao === 100 ? 'Conclu√≠do' :
            row.percentualConclusao > 0 ? 'Em Andamento' : 'Pendente') + '</span></td>';
        html += '<td><button class="btn" style="padding: 4px 8px; font-size: 12px;" onclick="verDetalhes(\'' +
          row.ID_Controle + '\')">üëÅÔ∏è</button></td>';
        html += '</tr>';
      });

      html += '</tbody></table>';
      document.getElementById('data-container').innerHTML = html;
    }

    function novoControle() {
      alert('Funcionalidade de novo controle em desenvolvimento');
    }

    function atualizarEtapa() {
      alert('Funcionalidade de atualiza√ß√£o de etapa em desenvolvimento');
    }

    function registrarOcorrencia() {
      alert('Funcionalidade de registro de ocorr√™ncia em desenvolvimento');
    }

    function verDetalhes(id) {
      alert('Ver detalhes do controle: ' + id);
    }
  </script>
</body>

</html>