<!--
  ========================================
  FORMS COMPONENT - ALIMENTAÇÃO ESCOLAR
  Formulários elegantes com labels flutuantes,
  validação em tempo real e máscaras de entrada
  ========================================
  
  Uso: <?!= include('UI_Forms'); ?>
-->

<style>
/* ========================================
   FORM BASE STYLES
   ======================================== */
.ae-form {
  width: 100%;
}

.ae-form-section {
  margin-bottom: 24px;
}

.ae-form-section-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--ae-primary, #2E7D32);
  margin-bottom: 16px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--ae-primary-100, #C8E6C9);
  display: flex;
  align-items: center;
  gap: 8px;
}

.ae-form-section-title .material-symbols-outlined {
  font-size: 20px;
}

.ae-form-row {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  margin-bottom: 16px;
}

@media (min-width: 640px) {
  .ae-form-row.cols-2 { grid-template-columns: repeat(2, 1fr); }
  .ae-form-row.cols-3 { grid-template-columns: repeat(3, 1fr); }
  .ae-form-row.cols-4 { grid-template-columns: repeat(4, 1fr); }
}

/* ========================================
   FLOATING LABEL INPUT
   ======================================== */
.ae-field {
  position: relative;
  margin-bottom: 4px;
}

.ae-field-input {
  width: 100%;
  padding: 20px 16px 8px;
  font-size: 1rem;
  font-family: inherit;
  color: var(--ae-text-primary, #263238);
  background: var(--ae-bg-card, #FFFFFF);
  border: 2px solid var(--ae-gray-300, #E0E0E0);
  border-radius: 10px;
  outline: none;
  transition: all 0.2s ease;
  min-height: 56px;
}

.ae-field-input:hover {
  border-color: var(--ae-gray-400, #BDBDBD);
}

.ae-field-input:focus {
  border-color: var(--ae-primary, #2E7D32);
  box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
}

.ae-field-input:disabled {
  background: var(--ae-gray-100, #F5F5F5);
  color: var(--ae-text-disabled, #9E9E9E);
  cursor: not-allowed;
}

/* Floating Label */
.ae-field-label {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1rem;
  color: var(--ae-text-hint, #78909C);
  pointer-events: none;
  transition: all 0.2s ease;
  background: transparent;
  padding: 0 4px;
}

.ae-field-input:focus ~ .ae-field-label,
.ae-field-input:not(:placeholder-shown) ~ .ae-field-label,
.ae-field-input.has-value ~ .ae-field-label {
  top: 8px;
  transform: translateY(0);
  font-size: 0.7rem;
  font-weight: 500;
  color: var(--ae-primary, #2E7D32);
  background: var(--ae-bg-card, #FFFFFF);
  left: 12px;
}

.ae-field-input:not(:focus):not(:placeholder-shown) ~ .ae-field-label {
  color: var(--ae-text-secondary, #546E7A);
}

/* Required indicator */
.ae-field-label .ae-required {
  color: var(--ae-accent, #C62828);
  margin-left: 2px;
}

/* Input with icon */
.ae-field.has-icon .ae-field-input {
  padding-left: 48px;
}

.ae-field.has-icon .ae-field-label {
  left: 48px;
}

.ae-field.has-icon .ae-field-input:focus ~ .ae-field-label,
.ae-field.has-icon .ae-field-input:not(:placeholder-shown) ~ .ae-field-label {
  left: 12px;
}

.ae-field-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--ae-text-hint, #78909C);
  pointer-events: none;
  transition: color 0.2s;
}

.ae-field-input:focus ~ .ae-field-icon {
  color: var(--ae-primary, #2E7D32);
}

/* Input with suffix (ex: R$, %) */
.ae-field.has-suffix .ae-field-input {
  padding-right: 60px;
}

.ae-field-suffix {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.9rem;
  color: var(--ae-text-hint, #78909C);
  pointer-events: none;
}

/* ========================================
   VALIDATION STATES
   ======================================== */
/* Success state */
.ae-field.success .ae-field-input {
  border-color: var(--ae-success, #2E7D32);
}

.ae-field.success .ae-field-input:focus {
  box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.15);
}

.ae-field.success .ae-field-label {
  color: var(--ae-success, #2E7D32);
}

/* Error state */
.ae-field.error .ae-field-input {
  border-color: var(--ae-error, #C62828);
  background: #FFFBFB;
}

.ae-field.error .ae-field-input:focus {
  box-shadow: 0 0 0 3px rgba(198, 40, 40, 0.1);
}

.ae-field.error .ae-field-label {
  color: var(--ae-error, #C62828);
}

.ae-field.error .ae-field-icon {
  color: var(--ae-error, #C62828);
}

/* Helper text and error message */
.ae-field-helper {
  display: flex;
  align-items: flex-start;
  gap: 4px;
  margin-top: 6px;
  font-size: 0.75rem;
  color: var(--ae-text-hint, #78909C);
  padding-left: 4px;
}

.ae-field-helper .material-symbols-outlined {
  font-size: 16px;
}

.ae-field-error {
  display: none;
  align-items: flex-start;
  gap: 4px;
  margin-top: 6px;
  font-size: 0.75rem;
  color: var(--ae-error, #C62828);
  padding-left: 4px;
}

.ae-field-error .material-symbols-outlined {
  font-size: 16px;
}

.ae-field.error .ae-field-error {
  display: flex;
}

.ae-field.error .ae-field-helper {
  display: none;
}

/* Character counter */
.ae-field-counter {
  position: absolute;
  right: 16px;
  bottom: -20px;
  font-size: 0.7rem;
  color: var(--ae-text-hint, #78909C);
}

.ae-field-counter.warning {
  color: var(--ae-warning, #F9A825);
}

.ae-field-counter.error {
  color: var(--ae-error, #C62828);
}

/* ========================================
   SELECT DROPDOWN
   ======================================== */
.ae-field-select {
  appearance: none;
  padding-right: 44px;
  cursor: pointer;
}

.ae-field.select::after {
  content: '';
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 6px solid var(--ae-text-hint, #78909C);
  pointer-events: none;
  transition: transform 0.2s;
}

.ae-field.select:focus-within::after {
  transform: translateY(-50%) rotate(180deg);
  border-top-color: var(--ae-primary, #2E7D32);
}

/* ========================================
   TEXTAREA
   ======================================== */
.ae-field-textarea {
  min-height: 120px;
  padding-top: 24px;
  resize: vertical;
  line-height: 1.5;
}

.ae-field-textarea ~ .ae-field-label {
  top: 24px;
}

.ae-field-textarea:focus ~ .ae-field-label,
.ae-field-textarea:not(:placeholder-shown) ~ .ae-field-label {
  top: 8px;
}

/* ========================================
   CHECKBOX & RADIO
   ======================================== */
.ae-checkbox-group,
.ae-radio-group {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.ae-checkbox-group.inline,
.ae-radio-group.inline {
  flex-direction: row;
  flex-wrap: wrap;
  gap: 16px;
}

.ae-checkbox,
.ae-radio {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  font-size: 0.9rem;
  color: var(--ae-text-primary, #263238);
}

.ae-checkbox input,
.ae-radio input {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.ae-checkbox-mark,
.ae-radio-mark {
  width: 22px;
  height: 22px;
  border: 2px solid var(--ae-gray-400, #BDBDBD);
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
}

.ae-checkbox-mark {
  border-radius: 6px;
}

.ae-radio-mark {
  border-radius: 50%;
}

.ae-checkbox-mark .material-symbols-outlined,
.ae-radio-mark::after {
  opacity: 0;
  transform: scale(0);
  transition: all 0.2s;
}

.ae-checkbox-mark .material-symbols-outlined {
  font-size: 18px;
  color: white;
}

.ae-radio-mark::after {
  content: '';
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--ae-primary, #2E7D32);
}

/* Checked state */
.ae-checkbox input:checked + .ae-checkbox-mark {
  background: var(--ae-primary, #2E7D32);
  border-color: var(--ae-primary, #2E7D32);
}

.ae-checkbox input:checked + .ae-checkbox-mark .material-symbols-outlined {
  opacity: 1;
  transform: scale(1);
}

.ae-radio input:checked + .ae-radio-mark {
  border-color: var(--ae-primary, #2E7D32);
}

.ae-radio input:checked + .ae-radio-mark::after {
  opacity: 1;
  transform: scale(1);
}

/* Focus state */
.ae-checkbox input:focus-visible + .ae-checkbox-mark,
.ae-radio input:focus-visible + .ae-radio-mark {
  box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
}

/* Disabled state */
.ae-checkbox input:disabled + .ae-checkbox-mark,
.ae-radio input:disabled + .ae-radio-mark {
  background: var(--ae-gray-100, #F5F5F5);
  border-color: var(--ae-gray-300, #E0E0E0);
  cursor: not-allowed;
}

.ae-checkbox input:disabled ~ span,
.ae-radio input:disabled ~ span {
  color: var(--ae-text-disabled, #9E9E9E);
  cursor: not-allowed;
}

/* ========================================
   SWITCH / TOGGLE
   ======================================== */
.ae-switch {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.ae-switch input {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.ae-switch-track {
  width: 48px;
  height: 26px;
  background: var(--ae-gray-300, #E0E0E0);
  border-radius: 13px;
  position: relative;
  transition: background 0.2s;
  flex-shrink: 0;
}

.ae-switch-thumb {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  transition: transform 0.2s;
}

.ae-switch input:checked + .ae-switch-track {
  background: var(--ae-primary, #2E7D32);
}

.ae-switch input:checked + .ae-switch-track .ae-switch-thumb {
  transform: translateX(22px);
}

.ae-switch input:focus-visible + .ae-switch-track {
  box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.2);
}

.ae-switch-label {
  font-size: 0.9rem;
  color: var(--ae-text-primary, #263238);
}

/* ========================================
   FILE UPLOAD
   ======================================== */
.ae-file-upload {
  position: relative;
}

.ae-file-dropzone {
  border: 2px dashed var(--ae-gray-300, #E0E0E0);
  border-radius: 12px;
  padding: 32px 24px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--ae-gray-50, #FAFAFA);
}

.ae-file-dropzone:hover {
  border-color: var(--ae-primary, #2E7D32);
  background: var(--ae-primary-50, #E8F5E9);
}

.ae-file-dropzone.dragover {
  border-color: var(--ae-primary, #2E7D32);
  background: var(--ae-primary-100, #C8E6C9);
}

.ae-file-dropzone input {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  opacity: 0;
  cursor: pointer;
}

.ae-file-dropzone-icon {
  font-size: 48px;
  color: var(--ae-gray-400, #BDBDBD);
  margin-bottom: 12px;
}

.ae-file-dropzone:hover .ae-file-dropzone-icon {
  color: var(--ae-primary, #2E7D32);
}

.ae-file-dropzone-text {
  font-size: 0.9rem;
  color: var(--ae-text-secondary, #546E7A);
  margin-bottom: 4px;
}

.ae-file-dropzone-hint {
  font-size: 0.75rem;
  color: var(--ae-text-hint, #78909C);
}

.ae-file-list {
  margin-top: 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.ae-file-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: white;
  border: 1px solid var(--ae-gray-200, #EEEEEE);
  border-radius: 8px;
}

.ae-file-item-icon {
  width: 40px;
  height: 40px;
  background: var(--ae-primary-50, #E8F5E9);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--ae-primary, #2E7D32);
}

.ae-file-item-info {
  flex: 1;
  min-width: 0;
}

.ae-file-item-name {
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--ae-text-primary, #263238);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.ae-file-item-size {
  font-size: 0.7rem;
  color: var(--ae-text-hint, #78909C);
}

.ae-file-item-remove {
  width: 32px;
  height: 32px;
  border: none;
  background: transparent;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--ae-text-hint, #78909C);
  transition: all 0.2s;
}

.ae-file-item-remove:hover {
  background: var(--ae-error-light, #FFEBEE);
  color: var(--ae-error, #C62828);
}

/* ========================================
   DATE PICKER WRAPPER
   ======================================== */
.ae-field-date {
  position: relative;
}

.ae-field-date input[type="date"] {
  padding-right: 44px;
}

.ae-field-date::after {
  content: 'calendar_today';
  font-family: 'Material Symbols Outlined';
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--ae-text-hint, #78909C);
  pointer-events: none;
}

/* ========================================
   FORM ACTIONS
   ======================================== */
.ae-form-actions {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding-top: 24px;
  margin-top: 24px;
  border-top: 1px solid var(--ae-gray-200, #EEEEEE);
}

.ae-form-actions.sticky {
  position: sticky;
  bottom: 0;
  background: var(--ae-bg-card, #FFFFFF);
  padding: 16px;
  margin: 0 -16px -16px;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
}

@media (max-width: 480px) {
  .ae-form-actions {
    flex-direction: column;
  }
  
  .ae-form-actions button {
    width: 100%;
  }
}
</style>

<script>
/**
 * ========================================
 * AE FORMS - VALIDAÇÃO E MÁSCARAS
 * ========================================
 */
const AEForms = {
  // Máscaras disponíveis
  masks: {
    cpf: { pattern: '###.###.###-##', placeholder: '000.000.000-00' },
    cnpj: { pattern: '##.###.###/####-##', placeholder: '00.000.000/0000-00' },
    phone: { pattern: '(##) #####-####', placeholder: '(00) 00000-0000' },
    cep: { pattern: '#####-###', placeholder: '00000-000' },
    date: { pattern: '##/##/####', placeholder: 'DD/MM/AAAA' },
    currency: { prefix: 'R$ ', decimal: ',', thousands: '.', precision: 2 },
    nfKey: { pattern: '#### #### #### #### #### #### #### #### #### #### ####', placeholder: '' }
  },

  // Validadores
  validators: {
    required: (value) => {
      if (!value || (typeof value === 'string' && !value.trim())) {
        return 'Este campo é obrigatório';
      }
      return null;
    },
    
    email: (value) => {
      if (!value) return null;
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return regex.test(value) ? null : 'E-mail inválido';
    },
    
    cpf: (value) => {
      if (!value) return null;
      const cpf = value.replace(/\D/g, '');
      if (cpf.length !== 11) return 'CPF deve ter 11 dígitos';
      if (/^(\d)\1+$/.test(cpf)) return 'CPF inválido';
      
      let sum = 0, rest;
      for (let i = 1; i <= 9; i++) sum += parseInt(cpf[i-1]) * (11 - i);
      rest = (sum * 10) % 11;
      if (rest === 10 || rest === 11) rest = 0;
      if (rest !== parseInt(cpf[9])) return 'CPF inválido';
      
      sum = 0;
      for (let i = 1; i <= 10; i++) sum += parseInt(cpf[i-1]) * (12 - i);
      rest = (sum * 10) % 11;
      if (rest === 10 || rest === 11) rest = 0;
      if (rest !== parseInt(cpf[10])) return 'CPF inválido';
      
      return null;
    },
    
    cnpj: (value) => {
      if (!value) return null;
      const cnpj = value.replace(/\D/g, '');
      if (cnpj.length !== 14) return 'CNPJ deve ter 14 dígitos';
      if (/^(\d)\1+$/.test(cnpj)) return 'CNPJ inválido';
      
      let size = cnpj.length - 2;
      let numbers = cnpj.substring(0, size);
      let digits = cnpj.substring(size);
      let sum = 0, pos = size - 7;
      
      for (let i = size; i >= 1; i--) {
        sum += numbers.charAt(size - i) * pos--;
        if (pos < 2) pos = 9;
      }
      let result = sum % 11 < 2 ? 0 : 11 - sum % 11;
      if (result != digits.charAt(0)) return 'CNPJ inválido';
      
      size = size + 1;
      numbers = cnpj.substring(0, size);
      sum = 0;
      pos = size - 7;
      for (let i = size; i >= 1; i--) {
        sum += numbers.charAt(size - i) * pos--;
        if (pos < 2) pos = 9;
      }
      result = sum % 11 < 2 ? 0 : 11 - sum % 11;
      if (result != digits.charAt(1)) return 'CNPJ inválido';
      
      return null;
    },
    
    minLength: (min) => (value) => {
      if (!value) return null;
      return value.length >= min ? null : `Mínimo de ${min} caracteres`;
    },
    
    maxLength: (max) => (value) => {
      if (!value) return null;
      return value.length <= max ? null : `Máximo de ${max} caracteres`;
    },
    
    min: (minVal) => (value) => {
      if (!value) return null;
      const num = parseFloat(value.replace(/[^\d,-]/g, '').replace(',', '.'));
      return num >= minVal ? null : `Valor mínimo: ${minVal}`;
    },
    
    max: (maxVal) => (value) => {
      if (!value) return null;
      const num = parseFloat(value.replace(/[^\d,-]/g, '').replace(',', '.'));
      return num <= maxVal ? null : `Valor máximo: ${maxVal}`;
    },
    
    pattern: (regex, message) => (value) => {
      if (!value) return null;
      return regex.test(value) ? null : message;
    }
  },

  // Aplicar máscara a um input
  applyMask(input, maskType) {
    const mask = this.masks[maskType];
    if (!mask) return;

    if (maskType === 'currency') {
      this.applyCurrencyMask(input, mask);
    } else {
      this.applyPatternMask(input, mask.pattern);
    }
  },

  applyPatternMask(input, pattern) {
    input.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      let result = '';
      let valueIndex = 0;

      for (let i = 0; i < pattern.length && valueIndex < value.length; i++) {
        if (pattern[i] === '#') {
          result += value[valueIndex++];
        } else {
          result += pattern[i];
          if (value[valueIndex] === pattern[i]) valueIndex++;
        }
      }

      e.target.value = result;
      this.updateFieldState(input);
    });
  },

  applyCurrencyMask(input, config) {
    input.addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (!value) {
        e.target.value = '';
        return;
      }

      value = (parseInt(value) / Math.pow(10, config.precision)).toFixed(config.precision);
      const parts = value.split('.');
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, config.thousands);
      
      e.target.value = config.prefix + parts.join(config.decimal);
      this.updateFieldState(input);
    });
  },

  // Validar um campo
  validateField(input, rules = []) {
    const field = input.closest('.ae-field');
    if (!field) return true;

    const value = input.value;
    let error = null;

    for (const rule of rules) {
      const validator = typeof rule === 'function' ? rule : this.validators[rule];
      if (validator) {
        error = validator(value);
        if (error) break;
      }
    }

    this.setFieldError(field, error);
    return !error;
  },

  // Definir erro no campo
  setFieldError(field, error) {
    const errorEl = field.querySelector('.ae-field-error');
    
    if (error) {
      field.classList.add('error');
      field.classList.remove('success');
      if (errorEl) {
        errorEl.innerHTML = `<span class="material-symbols-outlined">error</span>${error}`;
      }
    } else {
      field.classList.remove('error');
      if (field.querySelector('.ae-field-input')?.value) {
        field.classList.add('success');
      }
      if (errorEl) errorEl.innerHTML = '';
    }
  },

  // Atualizar estado do campo (has-value)
  updateFieldState(input) {
    if (input.value) {
      input.classList.add('has-value');
    } else {
      input.classList.remove('has-value');
    }
  },

  // Inicializar formulário
  initForm(form, config = {}) {
    const formEl = typeof form === 'string' ? document.querySelector(form) : form;
    if (!formEl) return;

    // Inicializar campos com máscaras
    formEl.querySelectorAll('[data-mask]').forEach(input => {
      this.applyMask(input, input.dataset.mask);
    });

    // Inicializar validação em tempo real
    formEl.querySelectorAll('[data-validate]').forEach(input => {
      const rules = input.dataset.validate.split(',').map(r => r.trim());
      
      input.addEventListener('blur', () => {
        this.validateField(input, rules);
      });

      input.addEventListener('input', () => {
        this.updateFieldState(input);
        // Remove erro enquanto digita
        const field = input.closest('.ae-field');
        if (field?.classList.contains('error')) {
          field.classList.remove('error');
        }
      });
    });

    // Inicializar contadores de caracteres
    formEl.querySelectorAll('[data-maxlength]').forEach(input => {
      const max = parseInt(input.dataset.maxlength);
      const counter = document.createElement('span');
      counter.className = 'ae-field-counter';
      input.closest('.ae-field')?.appendChild(counter);

      const updateCounter = () => {
        const len = input.value.length;
        counter.textContent = `${len}/${max}`;
        counter.classList.toggle('warning', len > max * 0.8);
        counter.classList.toggle('error', len > max);
      };

      input.addEventListener('input', updateCounter);
      updateCounter();
    });

    // Inicializar file upload
    formEl.querySelectorAll('.ae-file-dropzone').forEach(dropzone => {
      this.initFileUpload(dropzone);
    });

    // Validação no submit
    formEl.addEventListener('submit', (e) => {
      let isValid = true;
      
      formEl.querySelectorAll('[data-validate]').forEach(input => {
        const rules = input.dataset.validate.split(',').map(r => r.trim());
        if (!this.validateField(input, rules)) {
          isValid = false;
        }
      });

      if (!isValid) {
        e.preventDefault();
        // Scroll para o primeiro erro
        const firstError = formEl.querySelector('.ae-field.error');
        firstError?.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      if (config.onSubmit) {
        e.preventDefault();
        if (isValid) {
          const formData = new FormData(formEl);
          const data = Object.fromEntries(formData.entries());
          config.onSubmit(data);
        }
      }
    });

    return {
      validate: () => {
        let isValid = true;
        formEl.querySelectorAll('[data-validate]').forEach(input => {
          const rules = input.dataset.validate.split(',').map(r => r.trim());
          if (!this.validateField(input, rules)) isValid = false;
        });
        return isValid;
      },
      getData: () => {
        const formData = new FormData(formEl);
        return Object.fromEntries(formData.entries());
      },
      reset: () => {
        formEl.reset();
        formEl.querySelectorAll('.ae-field').forEach(field => {
          field.classList.remove('error', 'success');
          field.querySelector('.ae-field-input')?.classList.remove('has-value');
        });
      },
      setValues: (values) => {
        Object.entries(values).forEach(([name, value]) => {
          const input = formEl.querySelector(`[name="${name}"]`);
          if (input) {
            input.value = value;
            this.updateFieldState(input);
          }
        });
      }
    };
  },

  // Inicializar file upload
  initFileUpload(dropzone) {
    const input = dropzone.querySelector('input[type="file"]');
    const fileList = dropzone.parentElement.querySelector('.ae-file-list');

    ['dragenter', 'dragover'].forEach(event => {
      dropzone.addEventListener(event, (e) => {
        e.preventDefault();
        dropzone.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(event => {
      dropzone.addEventListener(event, (e) => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
      });
    });

    dropzone.addEventListener('drop', (e) => {
      const files = e.dataTransfer.files;
      this.handleFiles(files, fileList, input);
    });

    input?.addEventListener('change', (e) => {
      this.handleFiles(e.target.files, fileList, input);
    });
  },

  handleFiles(files, fileList, input) {
    if (!fileList) return;

    Array.from(files).forEach(file => {
      const item = document.createElement('div');
      item.className = 'ae-file-item';
      item.innerHTML = `
        <div class="ae-file-item-icon">
          <span class="material-symbols-outlined">description</span>
        </div>
        <div class="ae-file-item-info">
          <div class="ae-file-item-name">${file.name}</div>
          <div class="ae-file-item-size">${this.formatFileSize(file.size)}</div>
        </div>
        <button type="button" class="ae-file-item-remove">
          <span class="material-symbols-outlined">close</span>
        </button>
      `;

      item.querySelector('.ae-file-item-remove').addEventListener('click', () => {
        item.remove();
      });

      fileList.appendChild(item);
    });
  },

  formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
};

// Expor globalmente
window.AEForms = AEForms;

// Auto-inicializar formulários com data-ae-form
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('[data-ae-form]').forEach(form => {
    AEForms.initForm(form);
  });
});
</script>
