<!--
  FRONTEND STANDARDIZATION & FIXES
  Este arquivo contém correções críticas e padronizações para o frontend.
  Inclua: <?!= include('Frontend_Standardization_Fixes'); ?>
-->

<script>
    /**
     * FIX: CSSStyleSheet.prototype.cssRules
     * Previne erro "Cannot read properties of null (reading 'cssRules')"
     * causado por polyfills ou scripts acessando stylesheets cross-origin ou desabilitados.
     */
    (function () {
        try {
            const originalCssRules = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'cssRules');
            if (originalCssRules) {
                Object.defineProperty(CSSStyleSheet.prototype, 'cssRules', {
                    get: function () {
                        try {
                            return originalCssRules.get.call(this);
                        } catch (e) {
                            console.warn('Acesso a cssRules bloqueado ou falhou, retornando lista vazia.', e);
                            return { length: 0, item: () => null };
                        }
                    }
                });
            }
        } catch (e) {
            console.error('Erro ao aplicar patch em cssRules:', e);
        }
    })();

    /**
     * FIX: UXEnhanced Connection Check
     * Previne erro 404 em /ping
     */
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof UXEnhanced !== 'undefined' && UXEnhanced.connection) {
            UXEnhanced.connection.check = function () {
                // Em Apps Script, assumimos online se o script carregar
                // Podemos usar google.script.run para um check real se necessário
                if (!navigator.onLine) {
                    this.handleOffline();
                } else {
                    if (!this.isOnline) this.handleOnline();
                }
            };
        }
    });
</script>

<style>
    /* 
   * PADRONIZAÇÃO DE VARIÁVEIS CSS
   * Garante que variáveis essenciais existam mesmo se o Design System falhar
   */
    :root {
        /* Cores de Fallback */
        --primary: #1c4587;
        --secondary: #4CAF50;
        --error: #ef4444;
        --warning: #f59e0b;
        --success: #10b981;
        --info: #3b82f6;

        /* Texto */
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --text-inverse: #ffffff;

        /* Fundo */
        --bg-primary: #f9fafb;
        --bg-surface: #ffffff;

        /* Espaçamento */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-6: 1.5rem;

        /* Bordas */
        --border-radius-md: 0.5rem;
        --border-radius-lg: 0.75rem;
        --border-radius-xl: 1rem;

        /* Sombras */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    /* Padronização de Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.3);
    }

    /* Padronização de Foco */
    :focus-visible {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
    }
</style>