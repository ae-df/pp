<!-- 
  UI_Header_AE.html
  Cabe√ßalho do Sistema de Alimenta√ß√£o Escolar com Chatbot IA
  @version 2.0.0
  
  Requer: AE_Design_System.html
-->

<style>
  /* ============================================
   HEADER - ALIMENTA√á√ÉO ESCOLAR
   Usa tokens do AE Design System
   ============================================ */
  .ae-header {
    background: var(--ae-gradient-primary, linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%));
    color: var(--ae-text-inverse, white);
    position: sticky;
    top: 0;
    z-index: var(--ae-z-sticky, 200);
    box-shadow: var(--ae-shadow-md, 0 4px 8px rgba(0, 0, 0, 0.08));
  }

  .ae-header .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 var(--ae-space-4, 16px);
  }

  .ae-header-row-1 {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--ae-space-3, 12px) 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .ae-header-row-2 {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: var(--ae-space-2, 8px);
    padding: var(--ae-space-2, 8px) 0;
  }

  .ae-logo-section {
    display: flex;
    align-items: center;
    gap: var(--ae-space-3, 12px);
  }

  .ae-logo-icon {
    font-size: 32px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .ae-logo-text {
    font-size: var(--ae-font-2xl, 1.5rem);
    font-weight: 700;
    letter-spacing: -0.5px;
  }

  .ae-logo-subtitle {
    font-size: var(--ae-font-xs, 0.75rem);
    opacity: 0.85;
    font-weight: 400;
  }

  /* Bot√µes do Header */
  .ae-btn-icon {
    width: var(--ae-touch-min, 44px);
    height: var(--ae-touch-min, 44px);
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: var(--ae-text-inverse, white);
    border-radius: var(--ae-radius-full, 9999px);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--ae-transition-fast, 150ms ease);
    position: relative;
  }

  .ae-btn-icon:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  .ae-btn-icon:focus-visible {
    outline: 2px solid rgba(255, 255, 255, 0.5);
    outline-offset: 2px;
  }

  .ae-btn-icon i {
    font-size: 18px;
  }

  /* Badge de Notifica√ß√£o */
  .ae-notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--ae-error, #e53935);
    color: var(--ae-text-inverse, white);
    font-size: 10px;
    font-weight: 600;
    min-width: 18px;
    height: 18px;
    border-radius: var(--ae-radius-full, 9999px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    box-shadow: var(--ae-shadow-sm, 0 2px 4px rgba(0, 0, 0, 0.06));
  }

  .ae-notification-badge.hidden {
    display: none;
  }

  /* Menu Toggle */
  .ae-menu-toggle {
    display: none;
  }

  @media (max-width: 768px) {
    .ae-menu-toggle {
      display: flex;
    }
  }

  /* ============================================
   DRAWERS (Pain√©is Laterais)
   ============================================ */
  .ae-drawer-overlay {
    position: fixed;
    inset: 0;
    background: var(--ae-bg-overlay, rgba(0, 0, 0, 0.5));
    z-index: var(--ae-z-modal-backdrop, 400);
    opacity: 0;
    visibility: hidden;
    transition: all var(--ae-transition-base, 200ms ease);
    backdrop-filter: blur(4px);
  }

  .ae-drawer-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .ae-drawer {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    max-width: 90vw;
    height: 100vh;
    background: var(--ae-bg-surface, #fff);
    z-index: var(--ae-z-modal, 500);
    transition: right var(--ae-transition-slow, 300ms ease);
    display: flex;
    flex-direction: column;
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
  }

  .ae-drawer.active {
    right: 0;
  }

  .ae-drawer-header {
    padding: var(--ae-space-4, 16px) var(--ae-space-5, 20px);
    background: var(--ae-gradient-primary, linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%));
    color: var(--ae-text-inverse, white);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .ae-drawer-title {
    font-size: var(--ae-font-lg, 1.125rem);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: var(--ae-space-2, 8px);
  }

  .ae-drawer-close {
    width: 32px;
    height: 32px;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: var(--ae-text-inverse, white);
    border-radius: var(--ae-radius-full, 9999px);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background var(--ae-transition-fast, 150ms ease);
  }

  .ae-drawer-close:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .ae-drawer-body {
    flex: 1;
    overflow-y: auto;
    padding: var(--ae-space-4, 16px);
  }

  /* ============================================
   CHATBOT DRAWER
   ============================================ */
  .ae-chatbot-messages {
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-height: 300px;
    max-height: calc(100vh - 250px);
    overflow-y: auto;
    padding-bottom: 16px;
  }

  .ae-chat-message {
    max-width: 85%;
    padding: 12px 16px;
    border-radius: 16px;
    font-size: 14px;
    line-height: 1.5;
    animation: fadeInUp 0.3s ease;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .ae-chat-message.user {
    align-self: flex-end;
    background: var(--primary, #2e7d32);
    color: white;
    border-bottom-right-radius: 4px;
  }

  .ae-chat-message.assistant {
    align-self: flex-start;
    background: var(--bg-secondary, #f5f5f5);
    color: var(--text-primary, #333);
    border-bottom-left-radius: 4px;
  }

  .ae-chat-message.system {
    align-self: center;
    background: transparent;
    color: var(--text-secondary, #666);
    font-size: 12px;
    padding: 8px;
  }

  .ae-chat-typing {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: var(--bg-secondary, #f5f5f5);
    border-radius: 16px;
    width: fit-content;
  }

  .ae-chat-typing span {
    width: 8px;
    height: 8px;
    background: var(--text-secondary, #666);
    border-radius: 50%;
    animation: typing 1.4s infinite;
  }

  .ae-chat-typing span:nth-child(2) {
    animation-delay: 0.2s;
  }

  .ae-chat-typing span:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes typing {

    0%,
    60%,
    100% {
      transform: translateY(0);
      opacity: 0.4;
    }

    30% {
      transform: translateY(-6px);
      opacity: 1;
    }
  }

  /* Input do Chat */
  .ae-chat-input-container {
    padding: 16px;
    border-top: 1px solid var(--border, #e0e0e0);
    background: var(--bg-surface, #fff);
  }

  .ae-chat-input-wrapper {
    display: flex;
    gap: 8px;
    align-items: flex-end;
  }

  .ae-chat-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--border, #e0e0e0);
    border-radius: 24px;
    font-size: 14px;
    resize: none;
    max-height: 120px;
    font-family: inherit;
    transition: border-color 0.2s;
  }

  .ae-chat-input:focus {
    outline: none;
    border-color: var(--primary, #2e7d32);
  }

  .ae-chat-send {
    width: 44px;
    height: 44px;
    border: none;
    background: var(--primary, #2e7d32);
    color: white;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }

  .ae-chat-send:hover {
    background: var(--primary-dark, #1b5e20);
    transform: scale(1.05);
  }

  .ae-chat-send:disabled {
    background: var(--text-secondary, #999);
    cursor: not-allowed;
    transform: none;
  }

  /* ============================================
   SEARCH DRAWER
   ============================================ */
  .ae-search-input-container {
    padding: 16px;
    border-bottom: 1px solid var(--border, #e0e0e0);
  }

  .ae-search-input {
    width: 100%;
    padding: 12px 16px 12px 44px;
    border: 1px solid var(--border, #e0e0e0);
    border-radius: 8px;
    font-size: 14px;
    background: var(--bg-secondary, #f5f5f5) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23666' viewBox='0 0 24 24'%3E%3Cpath d='M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E") no-repeat 12px center;
    background-size: 20px;
  }

  .ae-search-input:focus {
    outline: none;
    border-color: var(--primary, #2e7d32);
    background-color: white;
  }

  .ae-search-results {
    padding: 8px;
  }

  .ae-search-result-item {
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .ae-search-result-item:hover {
    background: var(--bg-secondary, #f5f5f5);
  }

  .ae-search-result-icon {
    width: 36px;
    height: 36px;
    background: var(--primary-light, #e8f5e9);
    color: var(--primary, #2e7d32);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ae-search-result-info {
    flex: 1;
  }

  .ae-search-result-title {
    font-weight: 500;
    font-size: 14px;
  }

  .ae-search-result-type {
    font-size: 12px;
    color: var(--text-secondary, #666);
  }

  /* ============================================
   NOTIFICATIONS PANEL
   ============================================ */
  .ae-notification-item {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border, #e0e0e0);
    display: flex;
    gap: 12px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .ae-notification-item:hover {
    background: var(--bg-secondary, #f5f5f5);
  }

  .ae-notification-item.unread {
    background: var(--primary-light, #e8f5e9);
  }

  .ae-notification-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .ae-notification-icon.info {
    background: #e3f2fd;
    color: #1976d2;
  }

  .ae-notification-icon.success {
    background: #e8f5e9;
    color: #2e7d32;
  }

  .ae-notification-icon.warning {
    background: #fff3e0;
    color: #f57c00;
  }

  .ae-notification-icon.error {
    background: #ffebee;
    color: #d32f2f;
  }

  .ae-notification-content {
    flex: 1;
  }

  .ae-notification-title {
    font-weight: 500;
    font-size: 14px;
    margin-bottom: 4px;
  }

  .ae-notification-text {
    font-size: 13px;
    color: var(--text-secondary, #666);
    line-height: 1.4;
  }

  .ae-notification-time {
    font-size: 11px;
    color: var(--text-tertiary, #999);
    margin-top: 4px;
  }

  /* ============================================
   USER DRAWER
   ============================================ */
  .ae-user-profile {
    text-align: center;
    padding: 24px 16px;
    border-bottom: 1px solid var(--border, #e0e0e0);
  }

  .ae-user-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary, #2e7d32) 0%, var(--primary-dark, #1b5e20) 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 600;
    margin: 0 auto 12px;
  }

  .ae-user-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .ae-user-role {
    font-size: 14px;
    color: var(--text-secondary, #666);
  }

  .ae-user-menu {
    padding: 8px;
  }

  .ae-user-menu-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    color: var(--text-primary, #333);
    text-decoration: none;
  }

  .ae-user-menu-item:hover {
    background: var(--bg-secondary, #f5f5f5);
  }

  .ae-user-menu-item.danger {
    color: #d32f2f;
  }

  .ae-user-menu-item i {
    width: 20px;
    text-align: center;
  }

  /* Horizontal Nav Styles */
  .ae-horizontal-nav {
    display: flex;
    align-items: center;
    gap: 4px;
    overflow-x: auto;
    padding: 0 16px;
    margin-left: 16px;
    scrollbar-width: none;
    /* Firefox */
    -ms-overflow-style: none;
    /* IE/Edge */
    mask-image: linear-gradient(to right, transparent, black 10px, black 90%, transparent);
    -webkit-mask-image: linear-gradient(to right, transparent, black 10px, black 90%, transparent);
    max-width: calc(100vw - 300px);
    /* Adjust based on other elements */
  }

  .ae-horizontal-nav::-webkit-scrollbar {
    display: none;
  }

  .ae-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 6px 10px;
    min-width: 64px;
    color: rgba(255, 255, 255, 0.75);
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
    font-size: 10px;
    font-weight: 500;
    text-align: center;
    white-space: nowrap;
  }

  .ae-nav-item i {
    font-size: 18px;
    margin-bottom: 2px;
  }

  .ae-nav-item:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    transform: translateY(-2px);
  }

  .ae-nav-item.active {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  @media (max-width: 768px) {
    .ae-horizontal-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-surface, #fff);
      border-top: 1px solid var(--border, #e0e0e0);
      padding: 8px;
      margin: 0;
      z-index: 900;
      justify-content: flex-start;
      max-width: 100%;
      mask-image: none;
      -webkit-mask-image: none;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    }

    .ae-nav-item {
      color: var(--text-secondary, #666);
    }

    .ae-nav-item:hover {
      background: var(--bg-secondary, #f5f5f5);
      color: var(--primary, #2e7d32);
      transform: none;
    }

    .ae-nav-item.active {
      background: transparent;
      color: var(--primary, #2e7d32);
      box-shadow: none;
    }

    .ae-header {
      padding-bottom: 0;
    }
  }
</style>

<!-- ============================================
     HEADER HTML
     ============================================ -->
<header class="ae-header" role="banner">
  <div class="container">
    <!-- Linha 1: Logo e Menu -->
    <div class="ae-header-row-1">
      <div class="ae-logo-section">
        <button class="ae-btn-icon ae-menu-toggle" id="ae-menu-toggle" aria-label="Abrir menu de navega√ß√£o"
          aria-expanded="false" aria-controls="sidebar">
          <i class="fas fa-bars"></i>
        </button>
        <span class="ae-logo-icon">üçé</span>
        <div>
          <div class="ae-logo-text">AE</div>
        </div>
      </div>

      <!-- Navega√ß√£o Horizontal (Scrollable) -->
      <nav id="horizontal-nav" class="ae-horizontal-nav" role="navigation" aria-label="Menu principal">
        <a href="#" class="ae-nav-item active" data-section="dashboard" title="Vis√£o Geral"><i
            class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="#" class="ae-nav-item" data-section="cardapios" title="Planejamento de Card√°pios"><i
            class="fas fa-calendar-alt"></i><span>Card√°pios</span></a>
        <a href="#" class="ae-nav-item" data-section="alunos" title="Gest√£o de Alunos"><i
            class="fas fa-users"></i><span>Alunos</span></a>
        <a href="#" class="ae-nav-item" data-section="especiais" title="Alunos com Restri√ß√µes"><i
            class="fas fa-heartbeat"></i><span>Especiais</span></a>
        <a href="#" class="ae-nav-item" data-section="notas" title="Atesto de Notas Fiscais"><i
            class="fas fa-file-invoice-dollar"></i><span>Notas</span></a>
        <a href="#" class="ae-nav-item" data-section="entregas" title="Recebimento de Mercadorias"><i
            class="fas fa-truck"></i><span>Entregas</span></a>
        <a href="#" class="ae-nav-item" data-section="estoque" title="Controle de Estoque"><i
            class="fas fa-boxes"></i><span>Estoque</span></a>
        <a href="#" class="ae-nav-item" data-section="pedidos" title="Solicita√ß√£o de G√™neros"><i
            class="fas fa-shopping-cart"></i><span>Pedidos</span></a>
        <a href="#" class="ae-nav-item" data-section="fornecedores" title="Gest√£o de Fornecedores"><i
            class="fas fa-handshake"></i><span>Fornecedores</span></a>
        <a href="#" class="ae-nav-item" data-section="escolas" title="Unidades Escolares"><i
            class="fas fa-school"></i><span>Escolas</span></a>
        <a href="#" class="ae-nav-item" data-section="nutricao" title="Informa√ß√µes Nutricionais"><i
            class="fas fa-apple-alt"></i><span>Nutri√ß√£o</span></a>
        <a href="#" class="ae-nav-item" data-section="fichas" title="Fichas T√©cnicas"><i
            class="fas fa-clipboard-list"></i><span>Receitas</span></a>
        <a href="#" class="ae-nav-item" data-section="pnae" title="Agricultura Familiar"><i
            class="fas fa-tractor"></i><span>PNAE</span></a>
        <a href="#" class="ae-nav-item" data-section="aceitabilidade" title="Testes de Aceitabilidade"><i
            class="fas fa-thumbs-up"></i><span>Aceita√ß√£o</span></a>
        <a href="#" class="ae-nav-item" data-section="desperdicio" title="Controle de Desperd√≠cio"><i
            class="fas fa-trash-alt"></i><span>Desperd√≠cio</span></a>
        <a href="#" class="ae-nav-item" data-section="visitas" title="Visitas T√©cnicas"><i
            class="fas fa-clipboard-check"></i><span>Visitas</span></a>
        <a href="#" class="ae-nav-item" data-section="capacitacao" title="Capacita√ß√£o de Pessoal"><i
            class="fas fa-chalkboard-teacher"></i><span>Capacita√ß√£o</span></a>
        <a href="#" class="ae-nav-item" data-section="equipamentos" title="Gest√£o de Equipamentos"><i
            class="fas fa-blender"></i><span>Equipamentos</span></a>
        <a href="#" class="ae-nav-item" data-section="manutencao" title="Manuten√ß√£o"><i
            class="fas fa-tools"></i><span>Manuten√ß√£o</span></a>
        <a href="#" class="ae-nav-item" data-section="relatorios" title="Relat√≥rios Gerenciais"><i
            class="fas fa-chart-bar"></i><span>Relat√≥rios</span></a>
        <a href="#" class="ae-nav-item" data-section="ia" title="Relat√≥rios Inteligentes"><i
            class="fas fa-robot"></i><span>IA</span></a>
        <a href="#" class="ae-nav-item" data-section="docs" title="Documenta√ß√£o"><i
            class="fas fa-folder-open"></i><span>Docs</span></a>
        <a href="#" class="ae-nav-item" data-section="config" title="Configura√ß√µes do Sistema"><i
            class="fas fa-cog"></i><span>Config</span></a>
        <a href="#" class="ae-nav-item" data-section="ajuda" title="Ajuda e Suporte"><i
            class="fas fa-question-circle"></i><span>Ajuda</span></a>
      </nav>
    </div>

    <!-- Linha 2: A√ß√µes R√°pidas -->
    <div class="ae-header-row-2">
      <button class="ae-btn-icon" id="ae-tasks-btn" aria-label="Tarefas em andamento" title="Tarefas em Andamento">
        <i class="fas fa-tasks"></i>
        <span class="ae-notification-badge hidden" id="tasks-badge">0</span>
      </button>

      <button class="ae-btn-icon" id="ae-search-btn" aria-label="Buscar" title="Buscar (Ctrl+K)"
        aria-controls="search-drawer" aria-expanded="false">
        <i class="fas fa-search"></i>
      </button>

      <button class="ae-btn-icon" id="ae-chatbot-btn" aria-label="Assistente IA" title="Assistente IA (Ctrl+/)"
        aria-controls="chatbot-drawer" aria-expanded="false">
        <i class="fas fa-comment-dots"></i>
      </button>

      <button class="ae-btn-icon" id="ae-notifications-btn" aria-label="Notifica√ß√µes" title="Notifica√ß√µes"
        aria-controls="notification-drawer" aria-expanded="false">
        <i class="fas fa-bell"></i>
        <span class="ae-notification-badge hidden" id="notification-badge">0</span>
      </button>

      <button class="ae-btn-icon" id="ae-user-btn" aria-label="Perfil do usu√°rio" title="Minha Conta"
        aria-controls="user-drawer" aria-expanded="false">
        <i class="fas fa-user"></i>
      </button>
    </div>
  </div>
</header>

<!-- Overlay para Drawers -->
<div class="ae-drawer-overlay" id="ae-drawer-overlay"></div>

<!-- ============================================
     CHATBOT DRAWER
     ============================================ -->
<aside class="ae-drawer" id="chatbot-drawer" role="dialog" aria-labelledby="chatbot-title" aria-modal="true">
  <div class="ae-drawer-header">
    <h2 class="ae-drawer-title" id="chatbot-title">
      <i class="fas fa-robot"></i>
      Assistente AE
    </h2>
    <button class="ae-drawer-close" aria-label="Fechar assistente" onclick="AEHeader.closeDrawer('chatbot')">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="ae-drawer-body ae-chatbot-messages" id="chatbot-messages">
    <div class="ae-chat-message system">
      Ol√°! Sou o assistente de Alimenta√ß√£o Escolar. Como posso ajudar?
    </div>
  </div>

  <div class="ae-chat-input-container">
    <div class="ae-chat-input-wrapper">
      <textarea class="ae-chat-input" id="chatbot-input" placeholder="Digite sua mensagem..." rows="1"
        aria-label="Mensagem para o assistente"></textarea>
      <button class="ae-chat-send" id="chatbot-send" aria-label="Enviar mensagem">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</aside>

<!-- ============================================
     SEARCH DRAWER
     ============================================ -->
<aside class="ae-drawer" id="search-drawer" role="dialog" aria-labelledby="search-title" aria-modal="true">
  <div class="ae-drawer-header">
    <h2 class="ae-drawer-title" id="search-title">
      <i class="fas fa-search"></i>
      Buscar
    </h2>
    <button class="ae-drawer-close" aria-label="Fechar busca" onclick="AEHeader.closeDrawer('search')">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="ae-search-input-container">
    <input type="text" class="ae-search-input" id="search-input" placeholder="Buscar NF, fornecedor, produto..."
      aria-label="Campo de busca">
  </div>

  <div class="ae-drawer-body ae-search-results" id="search-results">
    <p style="text-align:center;color:var(--text-secondary);padding:20px;">
      Digite para buscar na base de dados
    </p>
  </div>
</aside>

<!-- ============================================
     NOTIFICATIONS DRAWER
     ============================================ -->
<aside class="ae-drawer" id="notification-drawer" role="dialog" aria-labelledby="notification-title" aria-modal="true">
  <div class="ae-drawer-header">
    <h2 class="ae-drawer-title" id="notification-title">
      <i class="fas fa-bell"></i>
      Notifica√ß√µes
    </h2>
    <button class="ae-drawer-close" aria-label="Fechar notifica√ß√µes" onclick="AEHeader.closeDrawer('notification')">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="ae-drawer-body" id="notification-list">
    <div class="ae-notification-item unread">
      <div class="ae-notification-icon info"><i class="fas fa-file-invoice"></i></div>
      <div class="ae-notification-content">
        <div class="ae-notification-title">Nova NF Recebida</div>
        <div class="ae-notification-text">NF 12345 do fornecedor ABC Alimentos aguarda confer√™ncia.</div>
        <div class="ae-notification-time">H√° 5 minutos</div>
      </div>
    </div>
    <div class="ae-notification-item">
      <div class="ae-notification-icon success"><i class="fas fa-check"></i></div>
      <div class="ae-notification-content">
        <div class="ae-notification-title">Atesto Conclu√≠do</div>
        <div class="ae-notification-text">Lote de NFs atestado com sucesso.</div>
        <div class="ae-notification-time">H√° 1 hora</div>
      </div>
    </div>
  </div>
</aside>

<!-- ============================================
     USER DRAWER
     ============================================ -->
<aside class="ae-drawer" id="user-drawer" role="dialog" aria-labelledby="user-title" aria-modal="true">
  <div class="ae-drawer-header">
    <h2 class="ae-drawer-title" id="user-title">
      <i class="fas fa-user"></i>
      Minha Conta
    </h2>
    <button class="ae-drawer-close" aria-label="Fechar perfil" onclick="AEHeader.closeDrawer('user')">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="ae-drawer-body">
    <div class="ae-user-profile">
      <div class="ae-user-avatar" id="user-avatar-initial">U</div>
      <div class="ae-user-name" id="user-display-name">Usu√°rio</div>
      <div class="ae-user-role" id="user-display-role">Analista</div>
    </div>

    <div class="ae-user-menu">
      <a href="#" class="ae-user-menu-item" onclick="AEHeader.openProfile()">
        <i class="fas fa-user-edit"></i>
        <span>Editar Perfil</span>
      </a>
      <a href="#" class="ae-user-menu-item" onclick="AEHeader.openSettings()">
        <i class="fas fa-cog"></i>
        <span>Configura√ß√µes</span>
      </a>
      <a href="#" class="ae-user-menu-item" onclick="AEHeader.openHelp()">
        <i class="fas fa-question-circle"></i>
        <span>Ajuda</span>
      </a>
      <hr style="margin:8px 0;border:none;border-top:1px solid var(--border,#e0e0e0);">
      <a href="#" class="ae-user-menu-item danger" onclick="AEHeader.logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sair</span>
      </a>
    </div>
  </div>
</aside>

<!-- ============================================
     JAVASCRIPT DO HEADER
     ============================================ -->
<script>
  /**
   * AEHeader - Controlador do Cabe√ßalho de Alimenta√ß√£o Escolar
   */
  var AEHeader = (function () {
    'use strict';

    // Estado
    var state = {
      activeDrawer: null,
      chatHistory: [],
      isTyping: false,
      notifications: [],
      searchDebounce: null
    };

    // Elementos
    var elements = {};

    /**
     * Inicializa o header
     */
    function init() {
      cacheElements();
      bindEvents();
      loadUserInfo();
      checkGeminiStatus();
      console.log('AEHeader inicializado');
    }

    /**
     * Cache de elementos DOM
     */
    function cacheElements() {
      elements = {
        overlay: document.getElementById('ae-drawer-overlay'),
        chatbotDrawer: document.getElementById('chatbot-drawer'),
        searchDrawer: document.getElementById('search-drawer'),
        notificationDrawer: document.getElementById('notification-drawer'),
        userDrawer: document.getElementById('user-drawer'),
        chatMessages: document.getElementById('chatbot-messages'),
        chatInput: document.getElementById('chatbot-input'),
        chatSend: document.getElementById('chatbot-send'),
        searchInput: document.getElementById('search-input'),
        searchResults: document.getElementById('search-results'),
        notificationBadge: document.getElementById('notification-badge'),
        tasksBadge: document.getElementById('tasks-badge')
      };
    }

    /**
     * Bindagem de eventos
     */
    function bindEvents() {
      // Bot√µes do header
      document.getElementById('ae-chatbot-btn')?.addEventListener('click', function () { toggleDrawer('chatbot'); });
      document.getElementById('ae-search-btn')?.addEventListener('click', function () { toggleDrawer('search'); });
      document.getElementById('ae-notifications-btn')?.addEventListener('click', function () { toggleDrawer('notification'); });
      document.getElementById('ae-user-btn')?.addEventListener('click', function () { toggleDrawer('user'); });
      document.getElementById('ae-menu-toggle')?.addEventListener('click', toggleSidebar);

      // Overlay
      elements.overlay?.addEventListener('click', closeAllDrawers);

      // Chat
      elements.chatSend?.addEventListener('click', sendChatMessage);
      elements.chatInput?.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendChatMessage();
        }
      });

      // Auto-resize textarea
      elements.chatInput?.addEventListener('input', function () {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
      });

      // Busca com debounce
      elements.searchInput?.addEventListener('input', function () {
        clearTimeout(state.searchDebounce);
        state.searchDebounce = setTimeout(function () {
          performSearch(elements.searchInput.value);
        }, 300);
      });

      // Atalhos de teclado
      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey || e.metaKey) {
          if (e.key === 'k') { e.preventDefault(); toggleDrawer('search'); }
          if (e.key === '/') { e.preventDefault(); toggleDrawer('chatbot'); }
        }
        if (e.key === 'Escape') { closeAllDrawers(); }
      });
    }
</script>

<script>
    /**
     * Toggle de drawer
     */
    function toggleDrawer(name) {
      var drawer = document.getElementById(name + '-drawer');
      if (!drawer) return;

      if (state.activeDrawer === name) {
        closeDrawer(name);
      } else {
        closeAllDrawers();
        openDrawer(name);
      }
    }

    /**
     * Abre um drawer
     */
    function openDrawer(name) {
      var drawer = document.getElementById(name + '-drawer');
      var btn = document.getElementById('ae-' + name + '-btn');

      if (drawer) {
        drawer.classList.add('active');
        elements.overlay?.classList.add('active');
        state.activeDrawer = name;
        btn?.setAttribute('aria-expanded', 'true');

        // Focus no input se for search ou chatbot
        if (name === 'search') elements.searchInput?.focus();
        if (name === 'chatbot') elements.chatInput?.focus();
      }
    }

    /**
     * Fecha um drawer
     */
    function closeDrawer(name) {
      var drawer = document.getElementById(name + '-drawer');
      var btn = document.getElementById('ae-' + name + '-btn');

      if (drawer) {
        drawer.classList.remove('active');
        btn?.setAttribute('aria-expanded', 'false');
      }

      if (state.activeDrawer === name) {
        elements.overlay?.classList.remove('active');
        state.activeDrawer = null;
      }
    }

    /**
     * Fecha todos os drawers
     */
    function closeAllDrawers() {
      ['chatbot', 'search', 'notification', 'user'].forEach(function (name) {
        closeDrawer(name);
      });
    }

    /**
     * Toggle sidebar (mobile)
     */
    function toggleSidebar() {
      var sidebar = document.getElementById('sidebar');
      var btn = document.getElementById('ae-menu-toggle');

      if (sidebar) {
        sidebar.classList.toggle('open');
        var isOpen = sidebar.classList.contains('open');
        btn?.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      }
    }

    /**
     * Envia mensagem para o chatbot
     */
    function sendChatMessage() {
      var message = elements.chatInput?.value?.trim();
      if (!message || state.isTyping) return;

      // Adiciona mensagem do usu√°rio
      addChatMessage(message, 'user');
      elements.chatInput.value = '';
      elements.chatInput.style.height = 'auto';

      // Mostra indicador de digita√ß√£o
      state.isTyping = true;
      elements.chatSend.disabled = true;
      showTypingIndicator();

      // Prepara hist√≥rico
      var historyText = state.chatHistory.slice(-6).map(function (m) {
        return m.role + ': ' + m.content;
      }).join('\n');

      // Chama backend
      google.script.run
        .withSuccessHandler(function (response) {
          hideTypingIndicator();
          state.isTyping = false;
          elements.chatSend.disabled = false;

          if (response && response.success) {
            addChatMessage(response.message, 'assistant');
            state.chatHistory.push({ role: 'Usu√°rio', content: message });
            state.chatHistory.push({ role: 'Assistente', content: response.message });
          } else {
            addChatMessage(response?.message || 'Desculpe, ocorreu um erro.', 'assistant');
          }
        })
        .withFailureHandler(function (error) {
          hideTypingIndicator();
          state.isTyping = false;
          elements.chatSend.disabled = false;
          addChatMessage('Erro de conex√£o. Tente novamente.', 'system');
          console.error('Erro chatbot:', error);
        })
        .chatbotMessage(message, historyText);
    }

    /**
     * Adiciona mensagem ao chat
     */
    function addChatMessage(text, type) {
      var div = document.createElement('div');
      div.className = 'ae-chat-message ' + type;
      div.textContent = text;
      elements.chatMessages?.appendChild(div);
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
    }

    /**
     * Mostra indicador de digita√ß√£o
     */
    function showTypingIndicator() {
      var div = document.createElement('div');
      div.className = 'ae-chat-typing';
      div.id = 'typing-indicator';
      div.innerHTML = '<span></span><span></span><span></span>';
      elements.chatMessages?.appendChild(div);
      elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
    }

    /**
     * Esconde indicador de digita√ß√£o
     */
    function hideTypingIndicator() {
      var indicator = document.getElementById('typing-indicator');
      indicator?.remove();
    }
</script>

<script>
    /**
     * Realiza busca na base de dados
     */
    function performSearch(query) {
      if (!query || query.length < 2) {
        elements.searchResults.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:20px;">Digite para buscar na base de dados</p>';
        return;
      }

      elements.searchResults.innerHTML = '<p style="text-align:center;padding:20px;"><i class="fas fa-spinner fa-spin"></i> Buscando...</p>';

      google.script.run
        .withSuccessHandler(function (response) {
          if (response && response.success && response.results.length > 0) {
            renderSearchResults(response.results);
          } else {
            elements.searchResults.innerHTML = '<p style="text-align:center;color:var(--text-secondary);padding:20px;">Nenhum resultado encontrado</p>';
          }
        })
        .withFailureHandler(function (error) {
          elements.searchResults.innerHTML = '<p style="text-align:center;color:var(--error);padding:20px;">Erro na busca</p>';
        })
        .buscaInteligente(query);
    }

    /**
     * Renderiza resultados da busca
     */
    function renderSearchResults(results) {
      var html = results.map(function (item) {
        var icon = item.tipo === 'Nota Fiscal' ? 'fa-file-invoice' : 'fa-building';
        return '<div class="ae-search-result-item" onclick="AEHeader.selectSearchResult(\'' + item.id + '\', \'' + item.tipo + '\')">' +
          '<div class="ae-search-result-icon"><i class="fas ' + icon + '"></i></div>' +
          '<div class="ae-search-result-info">' +
          '<div class="ae-search-result-title">' + escapeHtml(item.descricao) + '</div>' +
          '<div class="ae-search-result-type">' + item.tipo + '</div>' +
          '</div>' +
          '</div>';
      }).join('');

      elements.searchResults.innerHTML = html;
    }

    /**
     * Seleciona resultado da busca
     */
    function selectSearchResult(id, tipo) {
      closeDrawer('search');
      // Navegar para o item selecionado
      if (typeof navigateTo === 'function') {
        if (tipo === 'Nota Fiscal') navigateTo('notas');
        else if (tipo === 'Fornecedor') navigateTo('fornecedores');
      }
      console.log('Selecionado:', tipo, id);
    }

    /**
     * Carrega informa√ß√µes do usu√°rio
     */
    function loadUserInfo() {
      // Tenta obter do localStorage ou sessionStorage
      var userName = sessionStorage.getItem('userName') || 'Usu√°rio';
      var userRole = sessionStorage.getItem('userRole') || 'Analista';

      document.getElementById('user-display-name').textContent = userName;
      document.getElementById('user-display-role').textContent = userRole;
      document.getElementById('user-avatar-initial').textContent = userName.charAt(0).toUpperCase();
    }

    /**
     * Verifica status do Gemini
     */
    function checkGeminiStatus() {
      google.script.run
        .withSuccessHandler(function (status) {
          if (!status || !status.configured) {
            console.warn('Gemini API n√£o configurada');
          }
        })
        .withFailureHandler(function () { })
        .getGeminiStatus();
    }

    /**
     * Fun√ß√µes de menu do usu√°rio
     */
    function openProfile() { closeDrawer('user'); console.log('Abrir perfil'); }
    function openSettings() { closeDrawer('user'); console.log('Abrir configura√ß√µes'); }
    function openHelp() { closeDrawer('user'); console.log('Abrir ajuda'); }
    function logout() {
      if (confirm('Deseja realmente sair?')) {
        sessionStorage.clear();
        if (typeof handleLogout === 'function') handleLogout();
        else window.location.reload();
      }
    }

    /**
     * Atualiza badge de notifica√ß√µes
     */
    function updateNotificationBadge(count) {
      var badge = elements.notificationBadge;
      if (badge) {
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      }
    }

    /**
     * Escape HTML
     */
    function escapeHtml(text) {
      var div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // API P√∫blica
    return {
      init: init,
      toggleDrawer: toggleDrawer,
      openDrawer: openDrawer,
      closeDrawer: closeDrawer,
      closeAllDrawers: closeAllDrawers,
      selectSearchResult: selectSearchResult,
      openProfile: openProfile,
      openSettings: openSettings,
      openHelp: openHelp,
      logout: logout,
      updateNotificationBadge: updateNotificationBadge
    };
  })();

  // Inicializa quando DOM estiver pronto
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', AEHeader.init);
  } else {
    AEHeader.init();
  }
</script>