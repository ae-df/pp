<!--
  MOBILE FIRST S20 - UNIAE
  Sistema otimizado para Samsung S20 (6.2", 1440x3200, 20:9)
  Navegador: Lemur Browser
  Orienta√ß√£o: Vertical (Portrait)
  
  Inclua: <?!= include('Mobile_First_S20'); ?>
  
  ‚úÖ Touch targets 48px+ (WCAG)
  ‚úÖ Safe areas para punch-hole
  ‚úÖ Scroll suave e momentum
  ‚úÖ Gestos nativos
  ‚úÖ Performance otimizada
  ‚úÖ Offline-ready
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#667eea">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">

<style>
/* ========================================
   CSS RESET MOBILE-FIRST
   ======================================== */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
}

html {
  font-size: 16px;
  height: -webkit-fill-available;
  scroll-behavior: smooth;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
  font-size: 1rem;
  line-height: 1.5;
  color: var(--m-text);
  background: var(--m-bg);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  overscroll-behavior-y: contain;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  touch-action: pan-y;
}
</style>
<style
>
/* ========================================
   VARI√ÅVEIS MOBILE S20
   Samsung S20: 360x800 CSS pixels (device-pixel-ratio: 4)
   ======================================== */
:root {
  /* Safe Areas - Samsung S20 punch-hole */
  --m-safe-top: env(safe-area-inset-top, 24px);
  --m-safe-bottom: env(safe-area-inset-bottom, 0px);
  --m-safe-left: env(safe-area-inset-left, 0px);
  --m-safe-right: env(safe-area-inset-right, 0px);
  
  /* Cores Mobile */
  --m-primary: #667eea;
  --m-primary-dark: #5a67d8;
  --m-primary-light: rgba(102, 126, 234, 0.12);
  --m-success: #10b981;
  --m-warning: #f59e0b;
  --m-error: #ef4444;
  --m-info: #3b82f6;
  
  /* Texto */
  --m-text: #1f2937;
  --m-text-secondary: #6b7280;
  --m-text-muted: #9ca3af;
  --m-text-inverse: #ffffff;
  
  /* Fundos */
  --m-bg: #f3f4f6;
  --m-bg-card: #ffffff;
  --m-bg-elevated: #ffffff;
  --m-border: #e5e7eb;
  
  /* Touch Targets - WCAG 2.1 m√≠nimo 44px, recomendado 48px */
  --m-touch-min: 48px;
  --m-touch-comfortable: 52px;
  
  /* Espa√ßamentos */
  --m-space-xs: 4px;
  --m-space-sm: 8px;
  --m-space-md: 16px;
  --m-space-lg: 24px;
  --m-space-xl: 32px;
  
  /* Border Radius */
  --m-radius-sm: 8px;
  --m-radius-md: 12px;
  --m-radius-lg: 16px;
  --m-radius-xl: 20px;
  --m-radius-full: 9999px;
  
  /* Sombras Mobile (sutis para performance) */
  --m-shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --m-shadow-md: 0 2px 8px rgba(0,0,0,0.08);
  --m-shadow-lg: 0 4px 16px rgba(0,0,0,0.12);
  
  /* Transi√ß√µes r√°pidas */
  --m-transition-fast: 100ms ease-out;
  --m-transition-normal: 150ms ease-out;
  
  /* Header e Bottom Nav */
  --m-header-height: 56px;
  --m-bottom-nav-height: 64px;
}

/* Tema Escuro */
@media (prefers-color-scheme: dark) {
  :root {
    --m-text: #f3f4f6;
    --m-text-secondary: #d1d5db;
    --m-text-muted: #9ca3af;
    --m-bg: #111827;
    --m-bg-card: #1f2937;
    --m-bg-elevated: #374151;
    --m-border: #374151;
  }
}

/* ========================================
   LAYOUT MOBILE S20
   ======================================== */
.m-app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: -webkit-fill-available;
  padding-left: var(--m-safe-left);
  padding-right: var(--m-safe-right);
}

/* Header fixo */
.m-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: calc(var(--m-header-height) + var(--m-safe-top));
  padding-top: var(--m-safe-top);
  background: var(--m-primary);
  color: var(--m-text-inverse);
  display: flex;
  align-items: center;
  padding-left: var(--m-space-md);
  padding-right: var(--m-space-md);
  z-index: 100;
  box-shadow: var(--m-shadow-md);
}

.m-header-title {
  flex: 1;
  font-size: 18px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.m-header-actions {
  display: flex;
  gap: var(--m-space-xs);
}

/* Conte√∫do principal */
.m-content {
  flex: 1;
  padding-top: calc(var(--m-header-height) + var(--m-safe-top) + var(--m-space-md));
  padding-bottom: calc(var(--m-bottom-nav-height) + var(--m-safe-bottom) + var(--m-space-md));
  padding-left: var(--m-space-md);
  padding-right: var(--m-space-md);
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Bottom Navigation */
.m-bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: calc(var(--m-bottom-nav-height) + var(--m-safe-bottom));
  padding-bottom: var(--m-safe-bottom);
  background: var(--m-bg-card);
  border-top: 1px solid var(--m-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 100;
}

.m-nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-width: var(--m-touch-min);
  min-height: var(--m-touch-min);
  padding: var(--m-space-sm);
  color: var(--m-text-muted);
  text-decoration: none;
  border: none;
  background: transparent;
  cursor: pointer;
  transition: color var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.m-nav-item.active {
  color: var(--m-primary);
}

.m-nav-item:active {
  opacity: 0.7;
}

.m-nav-icon {
  font-size: 24px;
  line-height: 1;
  margin-bottom: 2px;
}

.m-nav-label {
  font-size: 11px;
  font-weight: 500;
}

/* ========================================
   COMPONENTES TOUCH-FRIENDLY
   ======================================== */

/* Bot√£o Mobile */
.m-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--m-space-sm);
  min-height: var(--m-touch-min);
  padding: 12px 20px;
  border: none;
  border-radius: var(--m-radius-md);
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: transform var(--m-transition-fast), opacity var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

.m-btn:active {
  transform: scale(0.96);
  opacity: 0.9;
}

.m-btn-primary {
  background: var(--m-primary);
  color: var(--m-text-inverse);
}

.m-btn-secondary {
  background: var(--m-bg-card);
  color: var(--m-text);
  border: 1.5px solid var(--m-border);
}

.m-btn-ghost {
  background: transparent;
  color: var(--m-primary);
}

.m-btn-block {
  width: 100%;
}

.m-btn-sm {
  min-height: 44px;
  padding: 10px 16px;
  font-size: 14px;
}

.m-btn-lg {
  min-height: 56px;
  padding: 16px 24px;
  font-size: 16px;
}

/* Icon Button */
.m-icon-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--m-touch-min);
  height: var(--m-touch-min);
  border: none;
  background: transparent;
  color: inherit;
  border-radius: var(--m-radius-full);
  cursor: pointer;
  transition: background var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.m-icon-btn:active {
  background: rgba(255,255,255,0.15);
}

.m-icon-btn .icon {
  font-size: 24px;
}

/* ========================================
   CARDS MOBILE
   ======================================== */
.m-card {
  background: var(--m-bg-card);
  border-radius: var(--m-radius-lg);
  padding: var(--m-space-md);
  margin-bottom: var(--m-space-md);
  box-shadow: var(--m-shadow-sm);
}

.m-card-header {
  display: flex;
  align-items: center;
  gap: var(--m-space-sm);
  margin-bottom: var(--m-space-md);
}

.m-card-icon {
  font-size: 24px;
}

.m-card-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--m-text);
}

.m-card-body {
  color: var(--m-text-secondary);
  font-size: 14px;
}

/* Card Interativo */
.m-card-interactive {
  cursor: pointer;
  transition: transform var(--m-transition-fast), box-shadow var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.m-card-interactive:active {
  transform: scale(0.98);
  box-shadow: var(--m-shadow-md);
}

/* ========================================
   GRID DE STATS
   ======================================== */
.m-stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--m-space-sm);
  margin-bottom: var(--m-space-md);
}

.m-stat-card {
  background: var(--m-bg-card);
  border-radius: var(--m-radius-md);
  padding: var(--m-space-md);
  text-align: center;
  box-shadow: var(--m-shadow-sm);
}

.m-stat-icon {
  font-size: 28px;
  margin-bottom: var(--m-space-xs);
}

.m-stat-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--m-primary);
  line-height: 1.2;
}

.m-stat-label {
  font-size: 12px;
  color: var(--m-text-muted);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* ========================================
   MENU GRID
   ======================================== */
.m-menu-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--m-space-sm);
}

.m-menu-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--m-space-sm);
  min-height: 100px;
  padding: var(--m-space-md);
  background: var(--m-bg-card);
  border: none;
  border-radius: var(--m-radius-lg);
  cursor: pointer;
  transition: transform var(--m-transition-fast);
  box-shadow: var(--m-shadow-sm);
  -webkit-tap-highlight-color: transparent;
}

.m-menu-item:active {
  transform: scale(0.96);
}

.m-menu-icon {
  font-size: 32px;
}

.m-menu-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--m-text);
  text-align: center;
}

/* ========================================
   LISTA MOBILE
   ======================================== */
.m-list {
  list-style: none;
}

.m-list-item {
  display: flex;
  align-items: center;
  gap: var(--m-space-md);
  min-height: var(--m-touch-comfortable);
  padding: var(--m-space-md);
  background: var(--m-bg-card);
  border-radius: var(--m-radius-md);
  margin-bottom: var(--m-space-sm);
  cursor: pointer;
  transition: transform var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.m-list-item:active {
  transform: scale(0.98);
  background: var(--m-bg-elevated);
}

.m-list-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.m-list-content {
  flex: 1;
  min-width: 0;
}

.m-list-title {
  font-size: 15px;
  font-weight: 500;
  color: var(--m-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.m-list-subtitle {
  font-size: 13px;
  color: var(--m-text-muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.m-list-action {
  flex-shrink: 0;
  font-size: 14px;
  font-weight: 600;
  color: var(--m-primary);
}

/* ========================================
   INPUTS MOBILE
   ======================================== */
.m-input-group {
  margin-bottom: var(--m-space-md);
}

.m-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--m-text);
  margin-bottom: var(--m-space-xs);
}

.m-input {
  width: 100%;
  min-height: var(--m-touch-min);
  padding: 12px 16px;
  border: 1.5px solid var(--m-border);
  border-radius: var(--m-radius-md);
  font-size: 16px; /* Previne zoom no iOS */
  color: var(--m-text);
  background: var(--m-bg-card);
  transition: border-color var(--m-transition-fast);
  -webkit-appearance: none;
  appearance: none;
}

.m-input:focus {
  outline: none;
  border-color: var(--m-primary);
  box-shadow: 0 0 0 3px var(--m-primary-light);
}

.m-input::placeholder {
  color: var(--m-text-muted);
}

/* Select Mobile */
.m-select {
  width: 100%;
  min-height: var(--m-touch-min);
  padding: 12px 40px 12px 16px;
  border: 1.5px solid var(--m-border);
  border-radius: var(--m-radius-md);
  font-size: 16px;
  color: var(--m-text);
  background: var(--m-bg-card) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 12px center;
  background-size: 20px;
  -webkit-appearance: none;
  appearance: none;
}

.m-select:focus {
  outline: none;
  border-color: var(--m-primary);
}

/* ========================================
   FAB (Floating Action Button)
   ======================================== */
.m-fab {
  position: fixed;
  bottom: calc(var(--m-bottom-nav-height) + var(--m-safe-bottom) + var(--m-space-md));
  right: var(--m-space-md);
  width: 56px;
  height: 56px;
  border-radius: var(--m-radius-lg);
  background: var(--m-primary);
  color: var(--m-text-inverse);
  border: none;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
  cursor: pointer;
  z-index: 90;
  transition: transform var(--m-transition-fast);
  -webkit-tap-highlight-color: transparent;
}

.m-fab:active {
  transform: scale(0.92);
}

/* FAB Mini */
.m-fab-mini {
  width: 44px;
  height: 44px;
  font-size: 20px;
}

/* ========================================
   TOAST MOBILE
   ======================================== */
.m-toast {
  position: fixed;
  bottom: calc(var(--m-bottom-nav-height) + var(--m-safe-bottom) + var(--m-space-lg));
  left: var(--m-space-md);
  right: var(--m-space-md);
  padding: 14px 20px;
  background: var(--m-text);
  color: var(--m-text-inverse);
  border-radius: var(--m-radius-md);
  font-size: 14px;
  font-weight: 500;
  text-align: center;
  z-index: 200;
  transform: translateY(100px);
  opacity: 0;
  transition: transform 0.25s ease, opacity 0.25s ease;
}

.m-toast.show {
  transform: translateY(0);
  opacity: 1;
}

.m-toast.success { background: var(--m-success); }
.m-toast.error { background: var(--m-error); }
.m-toast.warning { background: var(--m-warning); color: var(--m-text); }

/* ========================================
   MODAL MOBILE (Bottom Sheet)
   ======================================== */
.m-sheet-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 150;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s, visibility 0.2s;
}

.m-sheet-overlay.active {
  opacity: 1;
  visibility: visible;
}

.m-sheet {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--m-bg-card);
  border-radius: var(--m-radius-xl) var(--m-radius-xl) 0 0;
  padding: var(--m-space-md);
  padding-bottom: calc(var(--m-space-md) + var(--m-safe-bottom));
  max-height: 85vh;
  overflow-y: auto;
  z-index: 151;
  transform: translateY(100%);
  transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
}

.m-sheet-overlay.active .m-sheet {
  transform: translateY(0);
}

.m-sheet-handle {
  width: 36px;
  height: 4px;
  background: var(--m-border);
  border-radius: 2px;
  margin: 0 auto var(--m-space-md);
}

.m-sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--m-space-md);
}

.m-sheet-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--m-text);
}

/* ========================================
   LOADING MOBILE
   ======================================== */
.m-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--m-space-xl);
}

.m-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--m-border);
  border-top-color: var(--m-primary);
  border-radius: 50%;
  animation: m-spin 0.8s linear infinite;
}

@keyframes m-spin {
  to { transform: rotate(360deg); }
}

.m-loading-text {
  margin-top: var(--m-space-md);
  font-size: 14px;
  color: var(--m-text-secondary);
}

/* ========================================
   PULL TO REFRESH
   ======================================== */
.m-pull-indicator {
  position: fixed;
  top: calc(var(--m-header-height) + var(--m-safe-top));
  left: 50%;
  transform: translateX(-50%) translateY(-60px);
  width: 40px;
  height: 40px;
  background: var(--m-bg-card);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--m-shadow-md);
  z-index: 99;
  transition: transform 0.2s;
}

.m-pull-indicator.pulling {
  transform: translateX(-50%) translateY(10px);
}

.m-pull-indicator.refreshing .m-spinner {
  width: 24px;
  height: 24px;
}

/* ========================================
   BADGES E STATUS
   ======================================== */
.m-badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  border-radius: var(--m-radius-full);
  font-size: 12px;
  font-weight: 600;
}

.m-badge-primary {
  background: var(--m-primary-light);
  color: var(--m-primary);
}

.m-badge-success {
  background: rgba(16, 185, 129, 0.12);
  color: var(--m-success);
}

.m-badge-warning {
  background: rgba(245, 158, 11, 0.12);
  color: var(--m-warning);
}

.m-badge-error {
  background: rgba(239, 68, 68, 0.12);
  color: var(--m-error);
}

/* Status Dot */
.m-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  display: inline-block;
}

.m-status-dot.success { background: var(--m-success); }
.m-status-dot.warning { background: var(--m-warning); }
.m-status-dot.error { background: var(--m-error); }

/* ========================================
   EMPTY STATE
   ======================================== */
.m-empty {
  text-align: center;
  padding: var(--m-space-xl) var(--m-space-md);
}

.m-empty-icon {
  font-size: 56px;
  margin-bottom: var(--m-space-md);
  opacity: 0.6;
}

.m-empty-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--m-text);
  margin-bottom: var(--m-space-xs);
}

.m-empty-text {
  font-size: 14px;
  color: var(--m-text-muted);
  margin-bottom: var(--m-space-lg);
}

/* ========================================
   SWIPE ACTIONS
   ======================================== */
.m-swipe-container {
  position: relative;
  overflow: hidden;
}

.m-swipe-content {
  position: relative;
  background: var(--m-bg-card);
  transition: transform 0.2s ease;
  z-index: 1;
}

.m-swipe-actions {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  display: flex;
}

.m-swipe-action {
  width: 72px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
}

.m-swipe-action.edit { background: var(--m-info); }
.m-swipe-action.delete { background: var(--m-error); }

/* ========================================
   SKELETON LOADING
   ======================================== */
.m-skeleton {
  background: linear-gradient(90deg, var(--m-border) 25%, var(--m-bg) 50%, var(--m-border) 75%);
  background-size: 200% 100%;
  animation: m-skeleton-shimmer 1.5s infinite;
  border-radius: var(--m-radius-sm);
}

@keyframes m-skeleton-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.m-skeleton-text {
  height: 16px;
  margin-bottom: var(--m-space-sm);
}

.m-skeleton-text.short { width: 40%; }
.m-skeleton-text.medium { width: 70%; }

.m-skeleton-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
}

/* ========================================
   SCROLLBAR MOBILE
   ======================================== */
::-webkit-scrollbar {
  width: 3px;
  height: 3px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.15);
  border-radius: 3px;
}

/* ========================================
   UTILIT√ÅRIOS MOBILE
   ======================================== */
.m-text-center { text-align: center; }
.m-text-left { text-align: left; }
.m-text-right { text-align: right; }

.m-mt-sm { margin-top: var(--m-space-sm); }
.m-mt-md { margin-top: var(--m-space-md); }
.m-mt-lg { margin-top: var(--m-space-lg); }

.m-mb-sm { margin-bottom: var(--m-space-sm); }
.m-mb-md { margin-bottom: var(--m-space-md); }
.m-mb-lg { margin-bottom: var(--m-space-lg); }

.m-p-sm { padding: var(--m-space-sm); }
.m-p-md { padding: var(--m-space-md); }
.m-p-lg { padding: var(--m-space-lg); }

.m-flex { display: flex; }
.m-flex-col { flex-direction: column; }
.m-items-center { align-items: center; }
.m-justify-between { justify-content: space-between; }
.m-gap-sm { gap: var(--m-space-sm); }
.m-gap-md { gap: var(--m-space-md); }

.m-hidden { display: none !important; }
.m-visible { display: block !important; }

/* ========================================
   ANIMA√á√ïES
   ======================================== */
.m-fade-in {
  animation: m-fadeIn 0.2s ease;
}

@keyframes m-fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.m-slide-up {
  animation: m-slideUp 0.25s ease;
}

@keyframes m-slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Reduzir anima√ß√µes se preferido */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
<!-- 
Toast Container -->
<div id="mToast" class="m-toast"></div>

<!-- Bottom Sheet Overlay -->
<div class="m-sheet-overlay" id="mSheetOverlay">
  <div class="m-sheet" id="mSheet">
    <div class="m-sheet-handle"></div>
    <div class="m-sheet-header">
      <h3 class="m-sheet-title" id="mSheetTitle">T√≠tulo</h3>
      <button class="m-icon-btn" onclick="MobileS20.closeSheet()">‚úï</button>
    </div>
    <div class="m-sheet-body" id="mSheetBody"></div>
  </div>
</div>

<script>
/**
 * MobileS20 - Sistema Mobile otimizado para Samsung S20 + Lemur Browser
 */
const MobileS20 = {
  // ========================================
  // CONFIGURA√á√ÉO
  // ========================================
  config: {
    touchFeedback: true,
    hapticFeedback: true,
    pullToRefresh: true,
    swipeThreshold: 50
  },
  
  // ========================================
  // TOAST
  // ========================================
  toast(message, type = 'info', duration = 2500) {
    const toast = document.getElementById('mToast');
    if (!toast) return;
    
    toast.textContent = message;
    toast.className = 'm-toast ' + type + ' show';
    
    if (this.config.hapticFeedback) this.haptic('light');
    
    clearTimeout(this._toastTimer);
    this._toastTimer = setTimeout(() => {
      toast.classList.remove('show');
    }, duration);
  },
  
  success(msg) { this.toast(msg, 'success'); },
  error(msg) { this.toast(msg, 'error', 4000); },
  warning(msg) { this.toast(msg, 'warning'); },
  
  // ========================================
  // HAPTIC FEEDBACK
  // ========================================
  haptic(type = 'light') {
    if (!this.config.hapticFeedback || !('vibrate' in navigator)) return;
    
    const patterns = {
      light: [10],
      medium: [20],
      heavy: [30],
      success: [10, 50, 10],
      error: [50, 30, 50]
    };
    
    navigator.vibrate(patterns[type] || patterns.light);
  },
  
  // ========================================
  // BOTTOM SHEET
  // ========================================
  openSheet(title, content) {
    const overlay = document.getElementById('mSheetOverlay');
    const titleEl = document.getElementById('mSheetTitle');
    const bodyEl = document.getElementById('mSheetBody');
    
    if (titleEl) titleEl.textContent = title;
    if (bodyEl) bodyEl.innerHTML = typeof content === 'string' ? content : '';
    if (overlay) overlay.classList.add('active');
    
    this.haptic('light');
    
    // Prevenir scroll do body
    document.body.style.overflow = 'hidden';
  },
  
  closeSheet() {
    const overlay = document.getElementById('mSheetOverlay');
    if (overlay) overlay.classList.remove('active');
    document.body.style.overflow = '';
  },
  
  // ========================================
  // LOADING
  // ========================================
  _loadingEl: null,
  
  showLoading(message = 'Carregando...') {
    if (!this._loadingEl) {
      this._loadingEl = document.createElement('div');
      this._loadingEl.className = 'm-sheet-overlay';
      this._loadingEl.innerHTML = `
        <div class="m-loading" style="background:var(--m-bg-card);padding:32px;border-radius:var(--m-radius-lg);">
          <div class="m-spinner"></div>
          <div class="m-loading-text">${message}</div>
        </div>
      `;
      document.body.appendChild(this._loadingEl);
    } else {
      this._loadingEl.querySelector('.m-loading-text').textContent = message;
    }
    this._loadingEl.classList.add('active');
    document.body.style.overflow = 'hidden';
  },
  
  hideLoading() {
    if (this._loadingEl) {
      this._loadingEl.classList.remove('active');
      document.body.style.overflow = '';
    }
  },
  
  // ========================================
  // PULL TO REFRESH
  // ========================================
  initPullToRefresh(callback) {
    if (!this.config.pullToRefresh) return;
    
    let startY = 0;
    let pulling = false;
    const threshold = 80;
    
    const content = document.querySelector('.m-content');
    if (!content) return;
    
    // Criar indicador
    let indicator = document.querySelector('.m-pull-indicator');
    if (!indicator) {
      indicator = document.createElement('div');
      indicator.className = 'm-pull-indicator';
      indicator.innerHTML = '<div class="m-spinner" style="width:24px;height:24px;"></div>';
      document.body.appendChild(indicator);
    }
    
    content.addEventListener('touchstart', (e) => {
      if (content.scrollTop === 0) {
        startY = e.touches[0].pageY;
        pulling = true;
      }
    }, { passive: true });
    
    content.addEventListener('touchmove', (e) => {
      if (!pulling) return;
      
      const currentY = e.touches[0].pageY;
      const diff = currentY - startY;
      
      if (diff > 0 && diff < threshold * 1.5) {
        indicator.classList.add('pulling');
        indicator.style.transform = `translateX(-50%) translateY(${Math.min(diff * 0.5, 40)}px)`;
      }
    }, { passive: true });
    
    content.addEventListener('touchend', () => {
      if (!pulling) return;
      pulling = false;
      
      const transform = indicator.style.transform;
      const match = transform.match(/translateY\((\d+)px\)/);
      const pullDistance = match ? parseInt(match[1]) : 0;
      
      if (pullDistance >= 30) {
        indicator.classList.add('refreshing');
        this.haptic('medium');
        
        if (callback) {
          callback().finally(() => {
            indicator.classList.remove('pulling', 'refreshing');
            indicator.style.transform = 'translateX(-50%) translateY(-60px)';
          });
        }
      } else {
        indicator.classList.remove('pulling');
        indicator.style.transform = 'translateX(-50%) translateY(-60px)';
      }
    }, { passive: true });
  },
  
  // ========================================
  // SWIPE ACTIONS
  // ========================================
  initSwipeActions(container) {
    const items = container.querySelectorAll('.m-swipe-container');
    
    items.forEach(item => {
      const content = item.querySelector('.m-swipe-content');
      const actions = item.querySelector('.m-swipe-actions');
      if (!content || !actions) return;
      
      let startX = 0;
      let currentX = 0;
      let isDragging = false;
      const maxSwipe = actions.offsetWidth;
      
      content.addEventListener('touchstart', (e) => {
        startX = e.touches[0].pageX;
        isDragging = true;
        content.style.transition = 'none';
      }, { passive: true });
      
      content.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        currentX = e.touches[0].pageX;
        const diff = startX - currentX;
        
        if (diff > 0 && diff <= maxSwipe) {
          content.style.transform = `translateX(-${diff}px)`;
        }
      }, { passive: true });
      
      content.addEventListener('touchend', () => {
        isDragging = false;
        content.style.transition = 'transform 0.2s ease';
        
        const diff = startX - currentX;
        
        if (diff > this.config.swipeThreshold) {
          content.style.transform = `translateX(-${maxSwipe}px)`;
          this.haptic('light');
        } else {
          content.style.transform = 'translateX(0)';
        }
      }, { passive: true });
      
      // Fechar ao clicar fora
      document.addEventListener('touchstart', (e) => {
        if (!item.contains(e.target)) {
          content.style.transform = 'translateX(0)';
        }
      }, { passive: true });
    });
  },
  
  // ========================================
  // NAVEGA√á√ÉO
  // ========================================
  setActiveNav(id) {
    document.querySelectorAll('.m-nav-item').forEach(item => {
      item.classList.toggle('active', item.dataset.nav === id);
    });
  },
  
  // ========================================
  // BACKEND CALLS
  // ========================================
  async call(fn, ...args) {
    return new Promise((resolve, reject) => {
      google.script.run
        .withSuccessHandler(resolve)
        .withFailureHandler(reject)
        [fn](...args);
    });
  },
  
  async callWithLoading(fn, message = 'Carregando...', ...args) {
    this.showLoading(message);
    try {
      const result = await this.call(fn, ...args);
      this.hideLoading();
      return result;
    } catch (error) {
      this.hideLoading();
      this.error('Erro ao processar');
      throw error;
    }
  },
  
  // ========================================
  // FORMATADORES
  // ========================================
  format: {
    currency(value) {
      if (value == null) return '-';
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
    },
    
    date(value) {
      if (!value) return '-';
      const d = new Date(value);
      return d.toLocaleDateString('pt-BR');
    },
    
    dateTime(value) {
      if (!value) return '-';
      const d = new Date(value);
      return d.toLocaleDateString('pt-BR') + ' ' + d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
    },
    
    relative(value) {
      if (!value) return '-';
      const d = new Date(value);
      const now = new Date();
      const diff = Math.floor((now - d) / 1000);
      
      if (diff < 60) return 'Agora';
      if (diff < 3600) return `${Math.floor(diff / 60)}min`;
      if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
      if (diff < 604800) return `${Math.floor(diff / 86400)}d`;
      return this.date(value);
    }
  },
  
  // ========================================
  // INICIALIZA√á√ÉO
  // ========================================
  init() {
    // Fechar sheet ao clicar no overlay
    const overlay = document.getElementById('mSheetOverlay');
    if (overlay) {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) this.closeSheet();
      });
    }
    
    // Touch feedback em bot√µes
    if (this.config.touchFeedback) {
      document.querySelectorAll('.m-btn, .m-menu-item, .m-list-item, .m-card-interactive').forEach(el => {
        el.addEventListener('touchstart', () => this.haptic('light'), { passive: true });
      });
    }
    
    // Navega√ß√£o bottom nav
    document.querySelectorAll('.m-nav-item').forEach(item => {
      item.addEventListener('click', () => {
        this.setActiveNav(item.dataset.nav);
        this.haptic('light');
      });
    });
    
    // Prevenir zoom em double-tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });
    
    console.log('üì± MobileS20 inicializado');
  }
};

// Auto-inicializar
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => MobileS20.init());
} else {
  MobileS20.init();
}

// Aliases globais
const mToast = (msg, type) => MobileS20.toast(msg, type);
const mSuccess = (msg) => MobileS20.success(msg);
const mError = (msg) => MobileS20.error(msg);
const mLoading = (msg) => MobileS20.showLoading(msg);
const mHideLoading = () => MobileS20.hideLoading();
</script>